<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ Tạo Mã Vạch Miễn Phí</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tải thư viện JsBarcode -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style cho placeholder của select khi disabled */
        select:invalid { color: gray; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="w-full max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-8 transition-all duration-300">
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Trình Tạo Mã Vạch</h1>
            <p class="text-gray-500 mt-2">Tạo mã vạch nhanh chóng và miễn phí</p>
        </div>

        <!-- Vùng nhập liệu -->
        <div class="space-y-6">
            <div>
                <label for="barcode-data" class="block text-sm font-medium text-gray-700 mb-1">Dữ liệu mã vạch</label>
                <input type="text" id="barcode-data" class="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-shadow" placeholder="Nhập văn bản hoặc số vào đây...">
            </div>

            <div>
                <label for="barcode-type" class="block text-sm font-medium text-gray-700 mb-1">Loại mã vạch</label>
                <select id="barcode-type" class="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-shadow">
                    <option value="CODE128" selected>CODE128</option>
                    <option value="CODE39">CODE39</option>
                    <option value="EAN13">EAN-13</option>
                    <option value="EAN8">EAN-8</option>
                    <option value="UPC">UPC</option>
                    <option value="ITF">ITF-14</option>
                    <option value="MSI">MSI</option>
                    <option value="pharmacode">Pharmacode</option>
                </select>
            </div>

            <button id="generate-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-300 transition-all duration-300 transform hover:scale-105">
                Tạo mã vạch
            </button>
        </div>

        <!-- Vùng hiển thị lỗi -->
        <div id="error-message" class="hidden mt-4 p-4 bg-red-100 text-red-700 border border-red-400 rounded-lg">
            <!-- Thông báo lỗi sẽ được chèn vào đây -->
        </div>

        <!-- Vùng hiển thị mã vạch -->
        <div id="barcode-container" class="mt-8 text-center hidden">
             <h2 class="text-xl font-semibold text-gray-700 mb-4">Mã vạch của bạn</h2>
             <div class="bg-white p-6 inline-block rounded-lg border border-gray-200 shadow-sm">
                <svg id="barcode"></svg>
             </div>
             <div class="mt-6">
                <button id="download-btn" class="bg-green-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-600 focus:outline-none focus:ring-4 focus:ring-green-300 transition-all duration-300">
                    Tải xuống (PNG)
                </button>
             </div>
        </div>
    </div>

    <script>
        // Lấy các phần tử DOM
        const generateBtn = document.getElementById('generate-btn');
        const downloadBtn = document.getElementById('download-btn');
        const barcodeDataInput = document.getElementById('barcode-data');
        const barcodeTypeSelect = document.getElementById('barcode-type');
        const barcodeContainer = document.getElementById('barcode-container');
        const barcodeSvg = document.getElementById('barcode');
        const errorMessageDiv = document.getElementById('error-message');

        // Hàm ẩn thông báo lỗi
        const hideError = () => {
            errorMessageDiv.classList.add('hidden');
        };

        // Hàm hiển thị thông báo lỗi
        const showError = (message) => {
            errorMessageDiv.textContent = message;
            errorMessageDiv.classList.remove('hidden');
            barcodeContainer.classList.add('hidden'); // Ẩn vùng mã vạch nếu có lỗi
        };

        // Hàm tạo mã vạch
        const generateBarcode = () => {
            const data = barcodeDataInput.value;
            const type = barcodeTypeSelect.value;

            // Ẩn lỗi cũ trước khi tạo mới
            hideError();

            if (!data) {
                showError('Vui lòng nhập dữ liệu để tạo mã vạch.');
                return;
            }

            try {
                // Sử dụng JsBarcode để tạo mã vạch
                JsBarcode(barcodeSvg, data, {
                    format: type,
                    displayValue: true,
                    fontSize: 18,
                    lineColor: "#000",
                    margin: 10,
                    height: 100,
                });
                // Hiển thị vùng chứa mã vạch
                barcodeContainer.classList.remove('hidden');
            } catch (e) {
                // Xử lý lỗi từ thư viện JsBarcode
                console.error(e);
                showError('Dữ liệu không hợp lệ cho loại mã vạch đã chọn. Vui lòng kiểm tra lại.');
            }
        };
        
        // Hàm tải mã vạch
        const downloadBarcode = () => {
            const svgElement = document.getElementById('barcode');
            const svgString = new XMLSerializer().serializeToString(svgElement);
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Lấy kích thước thực của SVG để canvas có kích thước chính xác
            const svgSize = svgElement.getBoundingClientRect();
            canvas.width = svgSize.width + 20; // Thêm padding
            canvas.height = svgSize.height + 20; // Thêm padding
            
            // Vẽ nền trắng cho canvas
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const img = new Image();
            // Chuyển đổi SVG string thành data URL
            const svgBlob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(svgBlob);
            
            img.onload = function() {
                // Vẽ ảnh lên canvas ở giữa
                ctx.drawImage(img, 10, 10);
                URL.revokeObjectURL(url);
                
                // Tạo link tải xuống
                const dataURL = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.href = dataURL;
                link.download = 'barcode.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };
            
            img.src = url;
        };


        // Gán sự kiện cho các nút
        generateBtn.addEventListener('click', generateBarcode);
        downloadBtn.addEventListener('click', downloadBarcode);
        
        // Tạo mã vạch khi nhấn Enter trong ô input
        barcodeDataInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                generateBarcode();
            }
        });

    </script>
</body>
</html>
