<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang quản lý Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: #f8f9fa;
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }
        .status-delivered { background-color: #dcfce7; color: #16a34a; }
        .status-processing { background-color: #cffafe; color: #0891b2; }
        .status-cancelled { background-color: #fee2e2; color: #dc2626; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-screen-2xl mx-auto">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Tổng quan Hệ thống</h1>
            <p class="text-gray-500 mt-1">Các chỉ số và thống kê quan trọng về hoạt động kinh doanh.</p>
        </header>

        <!-- Filter Section -->
        <div class="bg-white p-6 rounded-xl shadow-sm mb-8">
            <div class="flex flex-col md:flex-row items-center gap-6">
                <div class="flex-grow">
                    <label for="date-range-start" class="block text-sm font-medium text-gray-700 mb-1">Lọc theo ngày</label>
                    <div class="flex items-center space-x-4">
                        <input type="date" id="date-range-start" class="w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        <span class="text-gray-500">đến</span>
                        <input type="date" id="date-range-end" class="w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>
                <div class="flex items-end pt-6">
                     <button id="apply-filters-btn" class="w-full px-5 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-semibold flex items-center justify-center space-x-2">
                        <i class="fas fa-filter"></i>
                        <span>Lọc</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="space-y-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-xl shadow-sm flex items-center space-x-4">
                    <div class="bg-green-100 text-green-600 p-4 rounded-full"><i class="fas fa-dollar-sign fa-2x"></i></div>
                    <div>
                        <p class="text-gray-500 text-sm">Tổng doanh thu</p>
                        <p id="stat-revenue" class="text-3xl font-bold text-gray-800">0đ</p>
                    </div>
                </div>
                 <div class="bg-white p-6 rounded-xl shadow-sm flex items-center space-x-4">
                    <div class="bg-blue-100 text-blue-600 p-4 rounded-full"><i class="fas fa-box-open fa-2x"></i></div>
                    <div>
                        <p class="text-gray-500 text-sm">Đơn hàng mới</p>
                        <p id="stat-new-orders" class="text-3xl font-bold text-gray-800">0</p>
                    </div>
                </div>
                 <div class="bg-white p-6 rounded-xl shadow-sm flex items-center space-x-4">
                    <div class="bg-yellow-100 text-yellow-600 p-4 rounded-full"><i class="fas fa-user-plus fa-2x"></i></div>
                    <div>
                        <p class="text-gray-500 text-sm">Khách hàng mới</p>
                        <p id="stat-new-customers" class="text-3xl font-bold text-gray-800">0</p>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                <div class="lg:col-span-3 bg-white p-6 rounded-xl shadow-sm">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Biểu đồ doanh thu</h2>
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Tình trạng đơn hàng</h2>
                    <canvas id="orderStatusChart" class="mx-auto max-h-80"></canvas>
                </div>
            </div>

            <!-- Recent Orders Table -->
            <div class="bg-white rounded-xl shadow-sm">
                <h2 class="text-xl font-bold text-gray-800 p-6">Đơn hàng gần đây</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-600">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th class="p-4">Mã ĐH</th>
                                <th class="p-4">Khách hàng</th>
                                <th class="p-4">Ngày đặt</th>
                                <th class="p-4">Tổng tiền</th>
                                <th class="p-4">Trạng thái</th>
                            </tr>
                        </thead>
                        <tbody id="recent-orders-tbody">
                            <!-- Rows injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- MOCK DATA ---
            const mockData = {
                orders: [
                    { order_code: 'DH-0001', customer_name: 'Nguyễn Văn An', date: '2025-07-03', total: 1500000, status: 'delivered' },
                    { order_code: 'DH-0002', customer_name: 'Trần Thị Bình', date: '2025-07-03', total: 850000, status: 'processing' },
                    { order_code: 'DH-0003', customer_name: 'Lê Văn Cường', date: '2025-07-02', total: 2100000, status: 'delivered' },
                    { order_code: 'DH-0004', customer_name: 'Phạm Thị Dung', date: '2025-07-02', total: 450000, status: 'cancelled' },
                    { order_code: 'DH-0005', customer_name: 'Hoàng Văn Em', date: '2025-07-01', total: 3200000, status: 'delivered' },
                    { order_code: 'DH-0006', customer_name: 'Vũ Thị Lan', date: '2025-06-30', total: 950000, status: 'delivered' },
                    { order_code: 'DH-0007', customer_name: 'Trần Anh Tuấn', date: '2025-06-29', total: 1800000, status: 'delivered' },
                ],
                new_customers: 12,
            };

            // --- CHART INSTANCES ---
            let revenueChart, orderStatusChart;

            // --- HELPER FUNCTIONS ---
            const formatCurrency = (amount) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
            const formatDate = (dateString) => new Date(dateString).toLocaleDateString('vi-VN');

            // --- RENDER FUNCTIONS ---
            function updateDashboard() {
                // Update KPI Cards
                const totalRevenue = mockData.orders.filter(o => o.status === 'delivered').reduce((sum, o) => sum + o.total, 0);
                document.getElementById('stat-revenue').textContent = formatCurrency(totalRevenue);
                document.getElementById('stat-new-orders').textContent = mockData.orders.length;
                document.getElementById('stat-new-customers').textContent = mockData.new_customers;

                // Update Charts
                renderRevenueChart();
                renderOrderStatusChart();

                // Update Recent Orders Table
                renderRecentOrders();
            }

            function renderRevenueChart() {
                const ctx = document.getElementById('revenueChart').getContext('2d');
                const revenueData = {};
                mockData.orders.forEach(order => {
                    if (order.status === 'delivered') {
                        const date = formatDate(order.date);
                        revenueData[date] = (revenueData[date] || 0) + order.total;
                    }
                });

                const labels = Object.keys(revenueData).reverse();
                const data = labels.map(label => revenueData[label]);

                if (revenueChart) revenueChart.destroy();
                revenueChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Doanh thu',
                            data: data,
                            borderColor: 'rgba(79, 70, 229, 1)',
                            backgroundColor: 'rgba(79, 70, 229, 0.1)',
                            fill: true,
                            tension: 0.3,
                        }]
                    },
                    options: { responsive: true, plugins: { legend: { display: false } } }
                });
            }

            function renderOrderStatusChart() {
                const ctx = document.getElementById('orderStatusChart').getContext('2d');
                const statusCounts = { delivered: 0, processing: 0, cancelled: 0 };
                mockData.orders.forEach(order => {
                    if (statusCounts.hasOwnProperty(order.status)) {
                        statusCounts[order.status]++;
                    }
                });

                if (orderStatusChart) orderStatusChart.destroy();
                orderStatusChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Thành công', 'Đang xử lý', 'Đã hủy'],
                        datasets: [{
                            data: [statusCounts.delivered, statusCounts.processing, statusCounts.cancelled],
                            backgroundColor: ['#16a34a', '#0891b2', '#dc2626'],
                            hoverOffset: 4
                        }]
                    },
                    options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
                });
            }
            
            function renderRecentOrders() {
                const tbody = document.getElementById('recent-orders-tbody');
                const recentOrders = mockData.orders.slice(0, 5);
                tbody.innerHTML = recentOrders.map(order => {
                    const statusMap = {
                        delivered: { text: 'Thành công', class: 'status-delivered' },
                        processing: { text: 'Đang xử lý', class: 'status-processing' },
                        cancelled: { text: 'Đã hủy', class: 'status-cancelled' }
                    };
                    const statusInfo = statusMap[order.status] || { text: order.status, class: 'bg-gray-200 text-gray-800'};
                    return `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="p-4 font-semibold text-indigo-600">${order.order_code}</td>
                            <td class="p-4">${order.customer_name}</td>
                            <td class="p-4">${formatDate(order.date)}</td>
                            <td class="p-4 font-semibold">${formatCurrency(order.total)}</td>
                            <td class="p-4"><span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></td>
                        </tr>
                    `;
                }).join('');
            }
            
            // --- INITIALIZATION ---
            // Set default date range (last 7 days)
            const endDateInput = document.getElementById('date-range-end');
            const startDateInput = document.getElementById('date-range-start');
            const today = new Date();
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(today.getDate() - 6);
            endDateInput.value = today.toISOString().split('T')[0];
            startDateInput.value = sevenDaysAgo.toISOString().split('T')[0];
            
            updateDashboard();
        });
    </script>
</body>
</html>
