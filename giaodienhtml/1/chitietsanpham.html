<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPhone 15 Pro Max 256GB | Titan Tự nhiên</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Heroicons for Icons -->
    <script src="https://unpkg.com/heroicons@2.1.3/24/outline/index.js"></script>

    <!-- Swiper.js CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>

    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb; /* Light gray background */
        }
        
        .variant-selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
            color: #2563eb;
        }

        .carousel::-webkit-scrollbar { display: none; }
        .carousel { -ms-overflow-style: none; scrollbar-width: none; }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .accordion-icon {
            transition: transform 0.3s ease;
        }

        .tab-button {
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease-in-out;
        }
        .tab-active {
            border-color: #3b82f6; /* blue-500 */
            color: #2563eb; /* blue-600 */
            background-color: #eff6ff; /* blue-50 */
        }
        
        .description-content.collapsed {
            max-height: 300px;
            overflow: hidden;
            position: relative;
        }
        .description-content.collapsed::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: linear-gradient(to top, white, rgba(255,255,255,0));
        }
        
        #favorite-btn.favorited {
            color: #ef4444; /* red-500 */
        }
        
        .timer-box {
            background: #333;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .review-star {
            color: #d1d5db; /* gray-300 */
            cursor: pointer;
            transition: color 0.2s;
        }
        .review-star.hover, .review-star.selected {
            color: #f59e0b; /* amber-500 */
        }
        
        #sticky-bar {
            transition: transform 0.3s ease-in-out;
        }
        
        #lightbox-main-image {
            transition: transform 0.3s ease;
            cursor: zoom-in;
        }
        
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* === CSS MỚI CHO SWIPER.JS GALLERY === */
        .gallery-top {
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }

        .gallery-thumbs {
            padding-top: 0.5rem; /* Giảm padding */
        }

        .gallery-thumbs .swiper-slide {
            width: 20%; /* Hiển thị 5 ảnh cùng lúc */
            height: auto;
            opacity: 0.6; /* Giao diện giống FPT Shop */
            cursor: pointer;
            transition: opacity 0.3s ease;
            border: 2px solid transparent;
            border-radius: 0.375rem; /* rounded-md */
        }
        
        .gallery-thumbs .swiper-slide:hover {
            opacity: 1;
        }

        .gallery-thumbs .swiper-slide-thumb-active {
            opacity: 1;
            border-color: #3b82f6; /* Vẫn giữ border để người dùng biết ảnh nào đang active */
        }
        
        .gallery-thumbs .swiper-slide img {
             width: 100%;
             height: 100%;
             object-fit: cover;
             aspect-ratio: 1 / 1;
             border-radius: 0.25rem; /* rounded-sm */
        }
        
        /* Style cho các nút điều hướng */
        .thumb-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 0.5rem;
            border-radius: 9999px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            z-index: 10;
            transition: opacity 0.2s;
        }
        .thumb-nav-btn:hover {
            background-color: white;
        }
        .thumb-nav-btn.swiper-button-disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        .thumb-prev-btn { left: -12px; }
        .thumb-next-btn { right: -12px; }
        
        /* --- NEW STYLES FOR BUTTONS --- */
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .summarize-btn-animated {
            background: linear-gradient(90deg, #a1c4fd, #c2e9fb, #fbc2eb, #a6c1ee);
            background-size: 300% 300%;
            transition: all 0.4s ease;
        }

        .summarize-btn-animated:hover {
            animation: gradient-animation 4s ease infinite;
        }

        /* --- NEW STYLES FOR STORE CAROUSEL --- */
        #store-prev-btn.swiper-button-disabled,
        #store-next-btn.swiper-button-disabled {
             opacity: 0.3;
             pointer-events: none;
        }
        
        .navigation-hidden #store-prev-btn,
        .navigation-hidden #store-next-btn {
            display: none;
        }


    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto p-4 md:p-8">
        <!-- Main Product Section -->
        <main class="bg-white p-4 sm:p-6 md:p-8 rounded-xl shadow-sm">
            <!-- Breadcrumb -->
            <nav class="text-sm text-gray-500 mb-4">
                <a href="#" class="hover:underline">Trang chủ</a> &gt;
                <a href="#" class="hover:underline">Điện thoại</a> &gt;
                <a href="#" class="hover:underline">Apple</a> &gt;
                <span class="font-medium text-gray-700">iPhone 15 Pro Max 256GB</span>
            </nav>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12 lg:items-start">
                <!-- PHẦN 1: CỘT TRÁI - THƯ VIỆN HÌNH ẢNH (ĐÃ CẬP NHẬT VỚI SWIPER.JS) -->
                <div class="image-gallery lg:sticky top-8">
                    <!-- Slider ảnh chính -->
                    <div id="main-image-container" class="swiper gallery-top group relative cursor-pointer">
                        <div class="swiper-wrapper">
                            <!-- Swiper.js sẽ tự động tạo các slide ở đây -->
                        </div>
                    </div>
                    
                    <!-- Slider ảnh thu nhỏ và các nút bấm -->
                    <div class="relative mt-2">
                         <!-- Container cho các thumbnail -->
                        <div class="swiper gallery-thumbs">
                             <div class="swiper-wrapper" id="main-thumbnails-wrapper">
                                 <!-- Swiper.js sẽ tự động tạo các slide thumbnail ở đây -->
                             </div>
                        </div>

                        <!-- Các nút điều hướng -->
                        <div id="thumb-prev-btn" class="thumb-nav-btn thumb-prev-btn">
                             <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </div>
                        <div id="thumb-next-btn" class="thumb-nav-btn thumb-next-btn">
                             <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </div>
                    </div>
                </div>

                <!-- PHẦN 1: CỘT PHẢI - THÔNG TIN & HÀNH ĐỘNG -->
                <div class="product-info flex flex-col">
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-900">iPhone 15 Pro Max 256GB | Titan Tự nhiên | Chính hãng VN/A</h1>
                    
                    <div class="flex items-center flex-wrap gap-4 mt-2">
                        <span class="inline-flex items-center bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-0.5 rounded-full w-fit">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mr-1"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" /></svg>
                            Chính hãng
                        </span>
                        <button id="compare-btn" class="flex items-center gap-1.5 text-sm font-semibold text-blue-600 hover:text-blue-800">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M5 4a1 1 0 00-2 0v7.268a2 2 0 000 3.464V16a1 1 0 102 0v-1.268a2 2 0 000-3.464V4zM11 4a1 1 0 10-2 0v1.268a2 2 0 000 3.464V16a1 1 0 102 0V8.732a2 2 0 000-3.464V4zM16 3a1 1 0 011 1v7.268a2 2 0 010 3.464V16a1 1 0 11-2 0v-1.268a2 2 0 010-3.464V4a1 1 0 011-1z" />
                            </svg>
                            So sánh
                        </button>
                        <button id="favorite-btn" class="flex items-center gap-1.5 text-sm font-semibold text-gray-500 hover:text-red-500 transition-colors">
                            <span id="favorite-icon-container">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.5l1.318-1.182a4.5 4.5 0 116.364 6.364L12 21l-7.682-7.318a4.5 4.5 0 010-6.364z" />
                                </svg>
                            </span>
                            <span>Yêu thích</span>
                        </button>
                        <div class="relative">
                            <button id="share-btn" class="flex items-center gap-1.5 text-sm font-semibold text-gray-500 hover:text-blue-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" />
                                </svg>
                                <span>Chia sẻ</span>
                            </button>
                            <div id="share-popover" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-xl z-20 hidden">
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Facebook</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Twitter</a>
                                <button id="copy-link-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Sao chép link</button>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center gap-3 mt-3 text-sm text-gray-600">
                        <div class="flex items-center gap-1"><span class="font-bold text-yellow-500">4.9</span><div class="flex text-yellow-400">★★★★☆</div></div>
                        <div class="h-4 w-px bg-gray-300"></div><span><span class="font-semibold">1,258</span> đánh giá</span>
                        <div class="h-4 w-px bg-gray-300"></div><span><span class="font-semibold">4.6k</span> đã bán</span>
                    </div>
                    <div class="variants mt-6 space-y-4">
                        <div>
                            <h4 class="font-medium text-gray-800 mb-2">Dung lượng</h4>
                            <div class="flex gap-2 flex-wrap">
                                <button class="px-4 py-2 border-2 rounded-lg text-sm font-semibold variant-selected" onclick="selectVariant(this)">256GB</button>
                                <button class="px-4 py-2 border-2 border-gray-300 rounded-lg text-sm font-semibold text-gray-700 hover:border-blue-500" onclick="selectVariant(this)">512GB</button>
                                <button class="px-4 py-2 border-2 border-gray-300 rounded-lg text-sm font-semibold text-gray-700 hover:border-blue-500" onclick="selectVariant(this)">1TB</button>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-800 mb-2">Màu sắc: <span id="colorName" class="font-bold">Titan Tự nhiên</span></h4>
                            <div class="flex gap-2">
                                <button class="w-8 h-8 rounded-full bg-gray-300 ring-2 ring-blue-500 ring-offset-1 focus:outline-none" style="background-color: #8A8A8D;" onclick="selectColor(this, 'Titan Tự nhiên')"></button>
                                <button class="w-8 h-8 rounded-full bg-blue-900 ring-2 ring-transparent ring-offset-1 focus:outline-none" style="background-color: #2E3A48;" onclick="selectColor(this, 'Titan Xanh')"></button>
                                <button class="w-8 h-8 rounded-full bg-white border border-gray-300 ring-2 ring-transparent ring-offset-1 focus:outline-none" style="background-color: #F5F5F7;" onclick="selectColor(this, 'Titan Trắng')"></button>
                                <button class="w-8 h-8 rounded-full bg-gray-800 ring-2 ring-transparent ring-offset-1 focus:outline-none" style="background-color: #4A4A4A;" onclick="selectColor(this, 'Titan Đen')"></button>
                            </div>
                        </div>
                    </div>
                    <!-- Flash Sale Block -->
                    <div class="bg-orange-500 text-white p-4 rounded-lg mt-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-sm font-semibold">⚡ Online Giá Rẻ Quá</p>
                                <p class="text-3xl font-bold">30.490.000₫</p>
                                <p class="text-sm opacity-80"><span class="line-through">34.990.000₫</span> (-12%)</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm font-semibold">Kết thúc sau</p>
                                <div id="countdown-timer" class="flex gap-1 mt-1 text-lg">
                                    <span id="hours" class="timer-box">00</span>:
                                    <span id="minutes" class="timer-box">00</span>:
                                    <span id="seconds" class="timer-box">00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Permanent Price Block -->
                    <div class="price-block bg-gray-100 p-4 rounded-lg mt-4">
                        <div class="flex items-baseline gap-3">
                            <span class="text-3xl font-bold text-red-600">32.790.000₫</span>
                            <span class="text-lg text-gray-500 line-through">34.990.000₫</span>
                            <span class="bg-red-200 text-red-800 text-sm font-semibold px-2 py-0.5 rounded-md">-6%</span>
                        </div>
                    </div>

                    <!-- Store Availability Section -->
                    <section class="mt-6 p-4 sm:p-5 bg-gray-50 rounded-xl border border-gray-200">
                        <div>
                            <h3 class="font-semibold text-gray-900">Xem chi nhánh có hàng</h3>
                            <p class="text-sm text-gray-600 mt-1">Có <span class="font-bold text-blue-600">46</span> cửa hàng có sản phẩm</p>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-4">
                            <!-- City Selector -->
                            <select class="w-full p-2.5 bg-white border border-gray-300 rounded-lg text-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                                <option>Hồ Chí Minh</option>
                                <option>Hà Nội</option>
                                <option>Đà Nẵng</option>
                            </select>
                            <!-- District Selector -->
                            <select class="w-full p-2.5 bg-white border border-gray-300 rounded-lg text-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                                <option>Quận/Huyện</option>
                                <option>Quận 1</option>
                                <option>Quận 3</option>
                                <option>Quận Ba Đình</option>
                            </select>
                        </div>
                        <!-- Store List Carousel -->
                        <div class="relative mt-4">
                            <div id="store-swiper" class="swiper -mx-1 px-1 pb-2">
                                <div class="swiper-wrapper">
                                    <!-- Store Card 1 -->
                                    <div class="swiper-slide w-64 sm:w-72">
                                        <div class="store-card h-full flex flex-col bg-white p-4 border border-gray-200 rounded-lg">
                                            <p class="font-medium text-sm text-gray-800 leading-snug flex-grow">55B Trần Quang Khải, P. Tân Định, Q. 1</p>
                                            <div class="flex gap-2 mt-3 text-center">
                                                <a href="tel:02871083355" class="flex-1 text-sm text-red-600 font-semibold border border-red-200 bg-red-50 rounded-full py-1.5 px-2 hover:bg-red-100 transition-colors flex items-center justify-center gap-1.5">
                                                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M2 3.5A1.5 1.5 0 013.5 2h1.148a1.5 1.5 0 011.465 1.175l.716 3.223a1.5 1.5 0 01-1.052 1.767l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 006.254 6.254c.395.163.833-.07.95-.48l.267-.933a1.5 1.5 0 011.767-1.052l3.223.716A1.5 1.5 0 0118 15.352V16.5a1.5 1.5 0 01-1.5 1.5h-2.148a1.5 1.5 0 01-1.465-1.175l-.716-3.223a1.5 1.5 0 00-1.767-1.052l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 01-6.254-6.254c-.163-.395.07-.833.48-.95l.933-.267a1.5 1.5 0 001.052-1.767l-.716-3.223A1.5 1.5 0 013.5 2H2z" clip-rule="evenodd" /></svg>
                                                    <span>02871083355</span>
                                                </a>
                                                <a href="#" class="flex-1 text-sm text-gray-700 font-semibold border border-gray-300 rounded-full py-1.5 px-2 hover:bg-gray-100 transition-colors flex items-center justify-center gap-1.5">
                                                   <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.69 18.933l.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 00.281-.14c.186-.096.446-.24.757-.433.62-.384 1.445-.976 2.274-1.765C15.302 14.988 17 12.493 17 9A7 7 0 103 9c0 3.492 1.698 5.988 3.355 7.584a13.731 13.731 0 002.274 1.765 11.842 11.842 0 00.757.433.57.57 0 00.281.14l.018.008.006.003zM10 11.25a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z" clip-rule="evenodd" /></svg>
                                                    <span>Bản đồ</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Store Card 2 -->
                                    <div class="swiper-slide w-64 sm:w-72">
                                        <div class="store-card h-full flex flex-col bg-white p-4 border border-gray-200 rounded-lg">
                                            <p class="font-medium text-sm text-gray-800 leading-snug flex-grow">134 Nguyễn Thái Học, P. Phạm Ngũ Lão, Q.1, TP HCM</p>
                                            <div class="flex gap-2 mt-3 text-center">
                                                <a href="tel:02871000132" class="flex-1 text-sm text-red-600 font-semibold border border-red-200 bg-red-50 rounded-full py-1.5 px-2 hover:bg-red-100 transition-colors flex items-center justify-center gap-1.5">
                                                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M2 3.5A1.5 1.5 0 013.5 2h1.148a1.5 1.5 0 011.465 1.175l.716 3.223a1.5 1.5 0 01-1.052 1.767l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 006.254 6.254c.395.163.833-.07.95-.48l.267-.933a1.5 1.5 0 011.767-1.052l3.223.716A1.5 1.5 0 0118 15.352V16.5a1.5 1.5 0 01-1.5 1.5h-2.148a1.5 1.5 0 01-1.465-1.175l-.716-3.223a1.5 1.5 0 00-1.767-1.052l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 01-6.254-6.254c-.163-.395.07-.833.48-.95l.933-.267a1.5 1.5 0 001.052-1.767l-.716-3.223A1.5 1.5 0 013.5 2H2z" clip-rule="evenodd" /></svg>
                                                    <span>02871000132</span>
                                                </a>
                                                <a href="#" class="flex-1 text-sm text-gray-700 font-semibold border border-gray-300 rounded-full py-1.5 px-2 hover:bg-gray-100 transition-colors flex items-center justify-center gap-1.5">
                                                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.69 18.933l.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 00.281-.14c.186-.096.446-.24.757-.433.62-.384 1.445-.976 2.274-1.765C15.302 14.988 17 12.493 17 9A7 7 0 103 9c0 3.492 1.698 5.988 3.355 7.584a13.731 13.731 0 002.274 1.765 11.842 11.842 0 00.757.433.57.57 0 00.281.14l.018.008.006.003zM10 11.25a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z" clip-rule="evenodd" /></svg>
                                                    <span>Bản đồ</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Store Card 3 -->
                                    <div class="swiper-slide w-64 sm:w-72">
                                        <div class="store-card h-full flex flex-col bg-white p-4 border border-gray-200 rounded-lg">
                                            <p class="font-medium text-sm text-gray-800 leading-snug flex-grow">258 Tô Ký, P. Tân Chánh Hiệp, Q.12, TP HCM</p>
                                            <div class="flex gap-2 mt-3 text-center">
                                                <a href="tel:02871083355" class="flex-1 text-sm text-red-600 font-semibold border border-red-200 bg-red-50 rounded-full py-1.5 px-2 hover:bg-red-100 transition-colors flex items-center justify-center gap-1.5">
                                                     <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M2 3.5A1.5 1.5 0 013.5 2h1.148a1.5 1.5 0 011.465 1.175l.716 3.223a1.5 1.5 0 01-1.052 1.767l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 006.254 6.254c.395.163.833-.07.95-.48l.267-.933a1.5 1.5 0 011.767-1.052l3.223.716A1.5 1.5 0 0118 15.352V16.5a1.5 1.5 0 01-1.5 1.5h-2.148a1.5 1.5 0 01-1.465-1.175l-.716-3.223a1.5 1.5 0 00-1.767-1.052l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 01-6.254-6.254c-.163-.395.07-.833.48-.95l.933-.267a1.5 1.5 0 001.052-1.767l-.716-3.223A1.5 1.5 0 013.5 2H2z" clip-rule="evenodd" /></svg>
                                                    <span>02871083355</span>
                                                </a>
                                                <a href="#" class="flex-1 text-sm text-gray-700 font-semibold border border-gray-300 rounded-full py-1.5 px-2 hover:bg-gray-100 transition-colors flex items-center justify-center gap-1.5">
                                                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.69 18.933l.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 00.281-.14c.186-.096.446-.24.757-.433.62-.384 1.445-.976 2.274-1.765C15.302 14.988 17 12.493 17 9A7 7 0 103 9c0 3.492 1.698 5.988 3.355 7.584a13.731 13.731 0 002.274 1.765 11.842 11.842 0 00.757.433.57.57 0 00.281.14l.018.008.006.003zM10 11.25a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z" clip-rule="evenodd" /></svg>
                                                    <span>Bản đồ</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Carousel Navigation -->
                            <button id="store-prev-btn" class="absolute top-1/2 -translate-y-1/2 -left-3.5 bg-white rounded-full p-1.5 shadow-lg hover:bg-gray-100 transition-colors z-10">
                                <svg class="w-5 h-5 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"></path></svg>
                            </button>
                            <button id="store-next-btn" class="absolute top-1/2 -translate-y-1/2 -right-3.5 bg-white rounded-full p-1.5 shadow-lg hover:bg-gray-100 transition-colors z-10">
                                <svg class="w-5 h-5 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                        </div>
                    </section>

                    <div class="promotions mt-6">
                        <h3 class="font-semibold text-gray-800 mb-2">Khuyến mãi & Ưu đãi</h3>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-start gap-2 text-gray-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>Giảm thêm <span class="font-bold">500.000₫</span> khi thanh toán qua VNPAY.</span></li>
                            <li class="flex items-start gap-2 text-gray-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c1.657 0 3-1.343 3-3S13.657 2 12 2 9 3.343 9 5s1.343 3 3 3zm0 0v1m0-1c-1.657 0-3 1.343-3 3S10.343 11 12 11s3-1.343 3-3-1.343-3-3-3zm0 0c1.657 0 3 1.343 3 3s-1.343 3-3 3m0 0v7m0-7c-1.657 0-3 1.343-3 3s1.343 3 3 3"></path></svg><span>Tặng <span class="font-bold">Ốp lưng MagSafe</span> trị giá 1.200.000₫.</span></li>
                            <li class="flex items-start gap-2 text-gray-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg><span>Hỗ trợ <span class="font-bold">trả góp 0%</span> qua thẻ tín dụng.</span></li>
                        </ul>
                    </div>
                    
                    <div class="mt-6"><h4 class="font-medium text-gray-800 mb-2">Số lượng</h4><div class="flex items-center border border-gray-300 rounded-lg w-fit"><button id="minusBtn" class="px-3 py-1 text-lg text-gray-600 hover:bg-gray-100 rounded-l-md">-</button><input id="quantityInput" type="text" value="1" class="w-12 text-center border-l border-r font-semibold text-gray-800 focus:outline-none"><button id="plusBtn" class="px-3 py-1 text-lg text-gray-600 hover:bg-gray-100 rounded-r-md">+</button></div></div>
                    <div id="main-cta-buttons" class="mt-auto pt-6 flex flex-col sm:flex-row gap-3">
                        <button class="flex-1 w-full flex items-center justify-center gap-2 px-6 py-3.5 border-2 border-blue-600 text-blue-600 font-bold rounded-lg hover:bg-blue-50 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c.51 0 .962-.343 1.087-.835l1.838-6.839a1.5 1.5 0 00-1.087-1.835H4.215" /></svg>THÊM VÀO GIỎ HÀNG</button>
                        <button class="flex-1 w-full px-6 py-4 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition-colors">MUA NGAY</button>
                    </div>
                     <div class="text-sm text-gray-500 mt-4 text-center sm:text-left"><span class="font-semibold">Giao hàng dự kiến:</span> Thứ Ba, 30/06 - Thứ Tư, 01/07.</div>
                </div>
            </div>
        </main>
        
        <!-- Sections below the fold -->
        <div class="mt-10 md:mt-12 space-y-10 md:space-y-12">
            
            <!-- Mua Kèm Deal Sốc / Cheaper Together -->
            <section class="bg-white p-6 md:p-8 rounded-xl shadow-sm">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Mua Kèm Deal Sốc</h2>
                <div class="flex flex-col lg:flex-row items-center justify-center gap-4" id="bundle-deal-container">
                    
                    <!-- Wrapper for scrollable items -->
                    <div class="w-full flex items-center gap-4 overflow-x-auto lg:overflow-visible pb-4 lg:pb-0 lg:w-auto carousel">
                        <!-- Main Product -->
                        <div class="flex flex-col items-center text-center p-4 border border-gray-200 rounded-lg flex-shrink-0 w-44 sm:w-48">
                            <img src="https://placehold.co/150x150/f0f0f0/333?text=iPhone+15" class="w-32 h-32 object-contain mb-2">
                            <p class="font-semibold text-sm">iPhone 15 Pro Max</p>
                            <p class="font-bold text-red-600">30.490.000₫</p>
                        </div>

                        <div class="text-3xl font-light text-gray-400">+</div>

                        <!-- Bundle Item 1 -->
                        <div class="bundle-item flex flex-col items-center text-center p-4 border border-gray-200 rounded-lg relative flex-shrink-0 w-44 sm:w-48">
                            <input type="checkbox" data-price="4490000" class="bundle-checkbox absolute top-2 right-2 h-5 w-5 rounded text-blue-600 focus:ring-blue-500" checked>
                            <img src="https://placehold.co/150x150/e0e0e0/333?text=AirPods" class="w-32 h-32 object-contain mb-2">
                            <p class="font-semibold text-sm">AirPods Pro 2</p>
                            <p class="font-bold text-red-600">4.490.000₫ <span class="text-gray-500 line-through text-xs">5.990.000₫</span></p>
                        </div>

                        <div class="text-3xl font-light text-gray-400">+</div>

                        <!-- Bundle Item 2 -->
                        <div class="bundle-item flex flex-col items-center text-center p-4 border border-gray-200 rounded-lg relative flex-shrink-0 w-44 sm:w-48">
                            <input type="checkbox" data-price="890000" class="bundle-checkbox absolute top-2 right-2 h-5 w-5 rounded text-blue-600 focus:ring-blue-500">
                            <img src="https://placehold.co/150x150/d0d0d0/333?text=Sạc" class="w-32 h-32 object-contain mb-2">
                            <p class="font-semibold text-sm">Sạc nhanh 20W</p>
                            <p class="font-bold text-red-600">890.000₫ <span class="text-gray-500 line-through text-xs">1.200.000₫</span></p>
                        </div>
                    </div>

                    <div class="text-3xl font-light text-gray-400 hidden lg:block">=</div>

                    <!-- Total Price -->
                    <div class="w-full max-w-xs sm:w-auto lg:w-auto lg:max-w-none mt-4 lg:mt-0 lg:ml-4 p-4 border-2 border-red-500 rounded-lg text-center">
                        <p class="font-semibold">Tổng giá trị:</p>
                        <p id="bundle-total-price" class="text-2xl font-bold text-red-600 my-2">35.870.000₫</p>
                        <button class="w-full bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700">Thêm tất cả vào giỏ</button>
                    </div>
                </div>
            </section>

            <!-- PHẦN 2 & 3: TABS - BÀI VIẾT & THÔNG SỐ -->
            <section class="bg-white p-6 md:p-8 rounded-xl shadow-sm">
                <!-- Tab Buttons -->
                <div class="flex justify-center border-2 border-gray-200 rounded-xl p-1 mb-6 max-w-md mx-auto">
                    <button id="tab-desc-btn" class="tab-button w-1/2 py-2.5 px-4 rounded-lg text-sm font-semibold text-gray-600">Bài viết đánh giá</button>
                    <button id="tab-specs-btn" class="tab-button w-1/2 py-2.5 px-4 rounded-lg text-sm font-semibold tab-active">Thông số kỹ thuật</button>
                </div>

                <!-- Tab Content -->
                <div>
                    <!-- Content for Description Tab -->
                    <div id="tab-desc-content" class="tab-content hidden">
                        <div id="description-wrapper" class="description-content collapsed">
                            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Đặc điểm nổi bật của iPhone 15 Pro Max</h2>
                            <div class="space-y-8 prose max-w-none">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                                    <div><h3 class="text-xl font-semibold text-gray-800 mb-2">Khung viền Titan chuẩn hàng không vũ trụ</h3><p class="text-gray-600 leading-relaxed">iPhone 15 Pro là iPhone đầu tiên có thiết kế từ titan chuẩn hàng không vũ trụ, sử dụng hợp kim tương tự như trong tàu vũ trụ cho các sứ mệnh Sao Hỏa. Chất liệu này mang lại độ bền vượt trội và giúp iPhone Pro mới trở thành phiên bản nhẹ nhất từ trước đến nay.</p></div>
                                    <img src="https://placehold.co/500x300/e0e0e0/333?text=Khung+Titan" alt="Khung viền Titan" class="rounded-lg w-full">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                                     <img src="https://placehold.co/500x300/d0d0d0/333?text=Chip+A17+Pro" alt="Chip A17 Pro" class="rounded-lg w-full order-last md:order-first">
                                    <div><h3 class="text-xl font-semibold text-gray-800 mb-2">Chip A17 Pro. Quái vật hiệu năng.</h3><p class="text-gray-600 leading-relaxed">Chip A17 Pro mang đến một cuộc cách mạng đồ họa, cho trải nghiệm game di động đắm chìm hơn bao giờ hết, với môi trường cực kỳ chi tiết và nhân vật siêu thực. Hiệu năng CPU cũng nhanh hơn đến 10%, đảm bảo mọi tác vụ đều mượt mà.</p></div>
                                </div>
                                 <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                                    <div><h3 class="text-xl font-semibold text-gray-800 mb-2">Hệ thống camera Pro đột phá</h3><p class="text-gray-600 leading-relaxed">Từ khả năng đóng khung linh hoạt đầy ấn tượng đến ảnh chân dung thế hệ mới, hãy khám phá những gì bạn có thể làm với hệ thống camera iPhone mạnh mẽ nhất. Camera Chính 48MP cho ảnh độ phân giải siêu cao, cùng camera Telephoto 5x zoom quang học xa nhất từng có trên iPhone.</p></div>
                                    <img src="https://placehold.co/500x300/c0c0c0/333?text=Camera+Pro" alt="Hệ thống camera" class="rounded-lg w-full">
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-4">
                            <button id="read-more-btn" class="font-semibold text-blue-600 hover:text-blue-800">
                                Xem thêm
                            </button>
                        </div>
                    </div>
                    
                    <!-- Content for Specs Tab -->
                    <div id="tab-specs-content" class="tab-content">
                        <div class="space-y-3" id="specs-accordion">
                            <!-- Màn hình -->
                            <div>
                                <button class="accordion-button w-full flex justify-between items-center p-4 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                    <span class="font-semibold text-gray-800">Màn hình</span>
                                    <svg class="accordion-icon w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </button>
                                <div class="accordion-content">
                                    <div class="p-4 border border-t-0 border-gray-200 rounded-b-lg"><dl class="divide-y divide-gray-100"><div class="px-1 py-2 grid grid-cols-3 gap-4"><dt class="text-sm font-medium text-gray-600">Công nghệ màn hình</dt><dd class="text-sm text-gray-800 col-span-2">OLED</dd></div><div class="px-1 py-2 grid grid-cols-3 gap-4"><dt class="text-sm font-medium text-gray-600">Độ phân giải</dt><dd class="text-sm text-gray-800 col-span-2">Super Retina XDR (2796 x 1290 Pixels)</dd></div><div class="px-1 py-2 grid grid-cols-3 gap-4"><dt class="text-sm font-medium text-gray-600">Tần số quét</dt><dd class="text-sm text-gray-800 col-span-2">120 Hz ProMotion</dd></div></dl></div>
                                </div>
                            </div>
                            <!-- Camera -->
                            <div>
                                <button class="accordion-button w-full flex justify-between items-center p-4 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                    <span class="font-semibold text-gray-800">Camera</span>
                                    <svg class="accordion-icon w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </button>
                                <div class="accordion-content">
                                    <div class="p-4 border border-t-0 border-gray-200 rounded-b-lg"><dl class="divide-y divide-gray-100"><div class="px-1 py-2 grid grid-cols-3 gap-4"><dt class="text-sm font-medium text-gray-600">Camera sau</dt><dd class="text-sm text-gray-800 col-span-2">Chính 48 MP & Phụ 12 MP, 12 MP</dd></div><div class="px-1 py-2 grid grid-cols-3 gap-4"><dt class="text-sm font-medium text-gray-600">Camera trước</dt><dd class="text-sm text-gray-800 col-span-2">12 MP</dd></div></dl></div>
                                </div>
                            </div>
                             <!-- Hệ điều hành & CPU -->
                             <div>
                                <button class="accordion-button w-full flex justify-between items-center p-4 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                    <span class="font-semibold text-gray-800">Hệ điều hành & CPU</span>
                                    <svg class="accordion-icon w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </button>
                                <div class="accordion-content">
                                    <div class="p-4 border border-t-0 border-gray-200 rounded-b-lg"><dl class="divide-y divide-gray-100"><div class="px-1 py-2 grid grid-cols-3 gap-4"><dt class="text-sm font-medium text-gray-600">Chip xử lý (CPU)</dt><dd class="text-sm text-gray-800 col-span-2">Apple A17 Pro 6 nhân</dd></div></dl></div>
                                </div>
                            </div>
                             <!-- Kết nối -->
                             <div>
                                <button class="accordion-button w-full flex justify-between items-center p-4 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                    <span class="font-semibold text-gray-800">Kết nối</span>
                                    <svg class="accordion-icon w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </button>
                                <div class="accordion-content">
                                    <div class="p-4 border border-t-0 border-gray-200 rounded-b-lg"><dl class="divide-y divide-gray-100"><div class="px-1 py-2 grid grid-cols-3 gap-4"><dt class="text-sm font-medium text-gray-600">Cổng kết nối/sạc</dt><dd class="text-sm text-gray-800 col-span-2">Type-C</dd></div></dl></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- PHẦN 4: ĐÁNH GIÁ & NHẬN XÉT -->
            <section class="bg-white p-6 md:p-8 rounded-xl shadow-sm">
                <div class="flex justify-between items-center mb-6 flex-wrap gap-y-4">
                    <h2 class="text-2xl font-bold text-gray-900">Đánh giá & Nhận xét</h2>
                    <div class="flex gap-2">
                        <button id="summarize-reviews-btn" class="summarize-btn-animated text-white font-semibold py-2 px-4 rounded-lg transition-colors flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M15.5 2.75a.75.75 0 00-1.5 0v3.5a.75.75 0 001.5 0v-3.5zM12.5 6a.75.75 0 01.75-.75h2.5a.75.75 0 010 1.5h-2.5a.75.75 0 01-.75-.75zM8.5 6a.75.75 0 01.75-.75h2.5a.75.75 0 010 1.5h-2.5A.75.75 0 018.5 6zM5.5 6a.75.75 0 01.75-.75h2.5a.75.75 0 010 1.5h-2.5A.75.75 0 015.5 6zM3 9.25a.75.75 0 000 1.5h14a.75.75 0 000-1.5H3zM3 13.25a.75.75 0 000 1.5h14a.75.75 0 000-1.5H3z"/></svg>
                            ✨ Tóm tắt nhanh
                        </button>
                        <button id="write-review-btn" class="bg-gray-900 text-white font-semibold py-2 px-4 rounded-lg hover:bg-black transition-colors">Viết đánh giá</button>
                    </div>
                </div>
                <div id="review-summary-container" class="hidden mb-6 p-4 bg-violet-50 border border-violet-200 rounded-lg">
                    <!-- AI Summary will be injected here -->
                </div>
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="flex flex-col items-center justify-center md:border-r md:border-gray-200 md:pr-8">
                        <p class="text-4xl font-bold text-gray-800">4.9 / 5</p>
                        <div class="flex text-yellow-400 my-2">★★★★☆</div>
                        <p class="text-sm text-gray-600">(1,258 đánh giá)</p>
                    </div>
                    <div class="col-span-2">
                        <div class="space-y-1">
                            <div class="flex items-center gap-2 text-sm"><span class="text-yellow-400">5 ★</span><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-yellow-400 h-2.5 rounded-full" style="width: 85%"></div></div><span class="text-gray-600 w-12 text-right">1000</span></div>
                            <div class="flex items-center gap-2 text-sm"><span class="text-yellow-400">4 ★</span><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-yellow-400 h-2.5 rounded-full" style="width: 12%"></div></div><span class="text-gray-600 w-12 text-right">250</span></div>
                            <div class="flex items-center gap-2 text-sm"><span class="text-yellow-400">3 ★</span><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-yellow-400 h-2.5 rounded-full" style="width: 2%"></div></div><span class="text-gray-600 w-12 text-right">8</span></div>
                            <div class="flex items-center gap-2 text-sm"><span class="text-yellow-400">2 ★</span><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-yellow-400 h-2.5 rounded-full" style="width: 0%"></div></div><span class="text-gray-600 w-12 text-right">0</span></div>
                            <div class="flex items-center gap-2 text-sm"><span class="text-yellow-400">1 ★</span><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-yellow-400 h-2.5 rounded-full" style="width: 1%"></div></div><span class="text-gray-600 w-12 text-right">2</span></div>
                        </div>
                    </div>
                 </div>
                 <div class="mt-6 border-t border-gray-200 pt-6">
                    <div class="flex justify-between items-center mb-4 flex-wrap gap-y-4">
                        <h3 class="text-lg font-bold text-gray-800">1,258 Bình luận</h3>
                        <div class="flex gap-2 flex-wrap">
                            <button class="px-3 py-1 bg-gray-200 text-gray-800 text-sm font-medium rounded-full border-2 border-transparent hover:border-gray-400">Tất cả</button>
                            <button class="px-3 py-1 bg-gray-200 text-gray-800 text-sm font-medium rounded-full flex items-center gap-1 border-2 border-transparent hover:border-gray-400">5 <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg></button>
                            <!-- Other filter buttons -->
                        </div>
                    </div>
                    <div class="my-6">
                        <div class="flex items-center gap-2 relative">
                            <textarea id="comment-textarea" maxlength="3000" placeholder="Nhập nội dung bình luận..." class="w-full px-4 py-3 pr-56 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition resize-none"></textarea>
                            <span id="char-counter" class="absolute right-40 bottom-3 text-sm text-gray-400">0/3000</span>
                            <button id="comment-submit-btn" class="absolute right-2 bottom-1.5 bg-gray-800 text-white font-semibold py-2 px-5 rounded-lg hover:bg-gray-900 transition-colors">Gửi bình luận</button>
                        </div>
                    </div>
                    <div id="review-list">
                        <!-- Reviews will be rendered here by JS -->
                    </div>
                    <nav id="review-pagination" class="flex items-center justify-center mt-6"></nav>
                 </div>
            </section>
            
            <!-- PHẦN 5: HỎI & ĐÁP VỚI TRỢ LÝ AI -->
            <section class="bg-white p-6 md:p-8 rounded-xl shadow-sm">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Hỏi & Đáp với Trợ lý AI</h2>
                <div class="mb-6">
                    <textarea id="qna-textarea" placeholder="Nhập câu hỏi của bạn về iPhone 15 Pro Max..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" rows="3"></textarea>
                    <button id="ask-ai-btn" class="mt-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 3zM10 15a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 15zM4.134 5.866a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.06 1.06a.75.75 0 11-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zM15 10a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0115 10zM10 4a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 4zM5.866 14.134a.75.75 0 010 1.06l-1.06 1.06a.75.75 0 01-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm9.193-9.193a.75.75 0 010 1.06l-1.06 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zM10 16a6 6 0 100-12 6 6 0 000 12z" clip-rule="evenodd" /></svg>
                        ✨ Hỏi AI ngay
                    </button>
                </div>
                <div id="ai-answer-container" class="hidden mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <!-- AI Answer will be injected here -->
                </div>
                <h3 class="text-lg font-bold text-gray-800 mb-4 border-t pt-6">Hoặc xem các câu hỏi thường gặp</h3>
                <div id="qna-list" class="space-y-4">
                    <!-- Q&A items will be dynamically inserted here -->
                </div>
                <!-- Pagination -->
                <nav id="qna-pagination" class="flex items-center justify-center mt-6"></nav>
            </section>

            <!-- PHẦN 6: SẢN PHẨM TƯƠNG TỰ -->
            <section>
                 <h2 class="text-2xl font-bold text-gray-900 mb-6">Sản phẩm tương tự</h2>
                 <div class="carousel flex gap-4 overflow-x-auto pb-4">
                    <div class="product-card flex-shrink-0 w-52 bg-white rounded-lg shadow-sm overflow-hidden transform hover:-translate-y-1 transition-transform"><img src="https://placehold.co/200x200/e0e0e0/333?text=iPhone+15+Plus" class="w-full h-40 object-cover"><div class="p-3"><h4 class="font-semibold text-sm text-gray-800 truncate">iPhone 15 Plus 128GB</h4><p class="font-bold text-red-600 mt-1">24.990.000₫</p><div class="flex items-center gap-1 text-xs text-yellow-500 mt-1">4.8 ★</div></div></div>
                    <div class="product-card flex-shrink-0 w-52 bg-white rounded-lg shadow-sm overflow-hidden transform hover:-translate-y-1 transition-transform"><img src="https://placehold.co/200x200/e0e0e0/333?text=Galaxy+S24+Ultra" class="w-full h-40 object-cover"><div class="p-3"><h4 class="font-semibold text-sm text-gray-800 truncate">Samsung Galaxy S24 Ultra</h4><p class="font-bold text-red-600 mt-1">28.490.000₫</p><div class="flex items-center gap-1 text-xs text-yellow-500 mt-1">4.9 ★</div></div></div>
                    <div class="product-card flex-shrink-0 w-52 bg-white rounded-lg shadow-sm overflow-hidden transform hover:-translate-y-1 transition-transform"><img src="https://placehold.co/200x200/e0e0e0/333?text=iPhone+15+Pro" class="w-full h-40 object-cover"><div class="p-3"><h4 class="font-semibold text-sm text-gray-800 truncate">iPhone 15 Pro 128GB</h4><p class="font-bold text-red-600 mt-1">27.990.000₫</p><div class="flex items-center gap-1 text-xs text-yellow-500 mt-1">4.9 ★</div></div></div>
                 </div>
            </section>
        </div>
    </div>

    <!-- MODALS SECTION -->
    
    <!-- Image Lightbox Modal -->
    <div id="image-lightbox-modal" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden flex-col items-center justify-center p-4 transition-opacity duration-300">
        <div class="absolute top-4 left-1/2 -translate-x-1/2 z-10 flex items-center gap-4 bg-black/50 p-2 rounded-full">
            <button id="lightbox-zoom-in" class="text-white hover:text-gray-300"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path></svg></button>
            <button id="lightbox-zoom-out" class="text-white hover:text-gray-300"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"></path></svg></button>
            <button id="lightbox-fullscreen" class="text-white hover:text-gray-300"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 0h-4m4 0l-5-5"></path></svg></button>
        </div>
        <button id="close-lightbox-btn" class="absolute top-4 right-6 text-white text-5xl leading-none z-10 hover:text-gray-300">&times;</button>
        <div class="relative w-full h-full flex flex-col items-center justify-center">
            <div class="relative flex-1 flex items-center justify-center w-full max-h-[80vh] mt-12 mb-24 overflow-hidden">
                <img id="lightbox-main-image" src="" class="max-h-full max-w-full object-contain rounded-lg">
                <button id="lightbox-prev-btn" class="absolute left-4 sm:left-8 text-white p-2 rounded-full bg-black/40 hover:bg-black/70 transition-colors"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                <button id="lightbox-next-btn" class="absolute right-4 sm:right-8 text-white p-2 rounded-full bg-black/40 hover:bg-black/70 transition-colors"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>
            </div>
            <div class="absolute bottom-0 left-0 right-0 p-4 bg-black bg-opacity-20"><div class="max-w-4xl mx-auto"><div class="text-white text-left mb-4"><p id="lightbox-description" class="font-semibold text-lg"></p><p id="lightbox-counter" class="text-sm text-gray-300"></p></div><div id="lightbox-thumbnails" class="flex justify-center gap-2"></div></div></div>
        </div>
    </div>

    <!-- Write Review Modal -->
    <div id="review-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg transform transition-transform duration-300 scale-95">
            <div class="flex justify-between items-center p-4 border-b border-gray-200"><h3 class="text-xl font-bold text-gray-900">Viết đánh giá</h3><button id="close-review-modal-btn" class="text-gray-500 hover:text-gray-700 text-3xl leading-none">&times;</button></div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="font-semibold text-gray-700">Đánh giá của bạn</label>
                    <div id="review-stars-container" class="flex items-center gap-1 text-4xl mt-1">
                        <!-- Stars will be generated by JS -->
                    </div>
                </div>
                <div>
                    <label for="review-text" class="font-semibold text-gray-700">Bình luận</label>
                    <textarea id="review-text" placeholder="Hãy chia sẻ cảm nhận của bạn về sản phẩm..." class="mt-1 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" rows="4"></textarea>
                </div>
                <div>
                    <label class="font-semibold text-gray-700">Thêm hình ảnh/video</label>
                    <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                        <div class="space-y-1 text-center">
                            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
                            <div class="flex text-sm text-gray-600"><label for="file-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500"><span>Tải lên một file</span><input id="file-upload" name="file-upload" type="file" class="sr-only" multiple></label><p class="pl-1">hoặc kéo và thả</p></div>
                            <p class="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
                        </div>
                    </div>
                </div>
                <div class="text-right">
                    <button id="submit-review-btn" class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 transition-colors">Gửi đánh giá</button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Info Modal -->
    <div id="user-info-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md transform transition-transform duration-300 scale-95">
            <div class="flex justify-between items-center p-4 border-b flex-shrink-0">
                <h3 class="text-xl font-bold text-gray-900">Thông tin người gửi</h3>
                <button id="close-user-info-modal-btn" class="text-gray-500 hover:text-gray-700 text-3xl leading-none">&times;</button>
            </div>
            <div class="p-6 space-y-4 flex-grow">
                <div class="flex gap-4">
                    <label class="flex items-center"><input type="radio" name="gender" class="h-4 w-4 text-red-600 border-gray-300 focus:ring-red-500" checked> <span class="ml-2">Anh</span></label>
                    <label class="flex items-center"><input type="radio" name="gender" class="h-4 w-4 text-red-600 border-gray-300 focus:ring-red-500"> <span class="ml-2">Chị</span></label>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" placeholder="Nhập họ và tên" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <input type="tel" placeholder="Nhập số điện thoại" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <input type="email" placeholder="Nhập Email (nhận thông báo phản hồi)" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="p-6 bg-white border-t flex-shrink-0">
                <label class="flex items-center text-sm text-gray-600">
                    <input id="terms-checkbox" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <span class="ml-2">Tôi đồng ý với điều khoản dịch vụ, chính sách thu thập và xử lý dữ liệu cá nhân của Shop</span>
                </label>
                <button id="qna-complete-btn" class="mt-4 w-full bg-gray-300 text-gray-500 font-semibold py-3 rounded-lg cursor-not-allowed" disabled>Hoàn tất</button>
            </div>
        </div>
    </div>
    
    <!-- Sticky Add to Cart Bar -->
    <div id="sticky-bar" class="fixed bottom-4 left-1/2 -translate-x-1/2 w-[calc(100%-2rem)] max-w-5xl bg-white/80 backdrop-blur-lg p-3 sm:p-4 rounded-2xl shadow-2xl transform translate-y-full transition-transform duration-300 z-40">
        <div class="flex items-center justify-between gap-4 w-full">
            <!-- Left side: Product Info -->
            <div class="flex items-center gap-4 overflow-hidden">
                <img src="https://placehold.co/50x50/f0f0f0/333?text=i15" alt="iPhone 15 Pro Max" class="w-12 h-12 rounded-lg object-cover flex-shrink-0">
                <div class="hidden sm:block">
                    <p class="font-semibold text-sm text-gray-900 truncate">iPhone 15 Pro Max</p>
                    <p id="sticky-bar-variant-info" class="text-xs text-gray-600">Phân loại: 256GB, Titan Tự nhiên</p>
                </div>
            </div>
            <!-- Right side: Price & Buttons -->
            <div class="flex items-center gap-2 sm:gap-3 flex-shrink-0">
                <div class="hidden lg:block text-right">
                    <p class="font-bold text-red-600 text-lg">30.490.000₫</p>
                    <p class="text-xs text-gray-500 line-through">34.990.000₫</p>
                </div>
                <button class="hidden sm:flex items-center justify-center p-3 border-2 border-blue-600 text-blue-600 font-bold rounded-lg hover:bg-blue-50 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c.51 0 .962-.343 1.087-.835l1.838-6.839a1.5 1.5 0 00-1.087-1.835H4.215"></path></svg>
                </button>
                <button class="w-full sm:w-auto px-4 sm:px-6 py-3 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition-colors text-sm sm:text-base">
                    Mua Ngay
                </button>
            </div>
        </div>
    </div>


    <!-- Swiper.js Script -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!-- Main Application Script -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- GALLERY DATA ---
        const galleryData = [
            { thumb: 'https://placehold.co/120x120/f0f0f0/333?text=Góc+trước', main: 'https://placehold.co/600x600/f0f0f0/333?text=Góc+trước', lightbox: 'https://placehold.co/1200x1200/f0f0f0/333?text=Góc+trước', description: 'Vẻ ngoài cứng cáp, độ bền ấn tượng', type: 'image' },
            { thumb: 'https://placehold.co/120x120/e0e0e0/333?text=Góc+nghiêng', main: 'https://placehold.co/600x600/e0e0e0/333?text=Góc+nghiêng', lightbox: 'https://placehold.co/1200x1200/e0e0e0/333?text=Góc+nghiêng', description: 'Khung viền Titan chuẩn hàng không vũ trụ', type: 'image' },
            { thumb: 'https://placehold.co/120x120/d0d0d0/333?text=Cụm+Camera', main: 'https://placehold.co/600x600/d0d0d0/333?text=Cụm+Camera', lightbox: 'https://placehold.co/1200x1200/d0d0d0/333?text=Cụm+Camera', description: 'Hệ thống camera Pro đột phá', type: 'image' },
            { thumb: 'https://placehold.co/120x120/c0c0c0/333?text=Video+Review', main: 'https://placehold.co/600x600/c0c0c0/333?text=Video+Review', lightbox: 'https://placehold.co/1200x1200/c0c0c0/333?text=Video+Review', description: 'Video đánh giá chi tiết sản phẩm', type: 'video' },
            { thumb: 'https://placehold.co/120x120/b0b0b0/333?text=Ảnh+360°', main: 'https://placehold.co/600x600/b0b0b0/333?text=Ảnh+360°', lightbox: 'https://placehold.co/1200x1200/b0b0b0/333?text=Ảnh+360°', description: 'Trải nghiệm xoay 360 độ', type: '360' },
            { thumb: 'https://placehold.co/120x120/a0a0a0/333?text=Cạnh+trái', main: 'https://placehold.co/600x600/a0a0a0/333?text=Cạnh+trái', lightbox: 'https://placehold.co/1200x1200/a0a0a0/333?text=Cạnh+trái', description: 'Nút tác vụ Action Button mới', type: 'image' },
            { thumb: 'https://placehold.co/120x120/909090/333?text=Cạnh+phải', main: 'https://placehold.co/600x600/909090/333?text=Cạnh+phải', lightbox: 'https://placehold.co/1200x1200/909090/333?text=Cạnh+phải', description: 'Nút nguồn và cạnh máy', type: 'image' },
            { thumb: 'https://placehold.co/120x120/808080/333?text=Cổng+sạc', main: 'https://placehold.co/600x600/808080/333?text=Cổng+sạc', lightbox: 'https://placehold.co/1200x1200/808080/333?text=Cổng+sạc', description: 'Cổng sạc USB-C mới', type: 'image' }
        ];
        let currentImageIndex = 0; // Dùng cho lightbox

        // --- ELEMENTS ---
        const mainImageContainer = document.getElementById('main-image-container');
        const mainThumbnailsWrapper = document.getElementById('main-thumbnails-wrapper');
        const mainImageWrapper = mainImageContainer.querySelector('.swiper-wrapper');
        
        // Lightbox elements
        const lightboxModal = document.getElementById('image-lightbox-modal');
        const closeLightboxBtn = document.getElementById('close-lightbox-btn');
        const lightboxMainImage = document.getElementById('lightbox-main-image');
        const lightboxPrevBtn = document.getElementById('lightbox-prev-btn');
        const lightboxNextBtn = document.getElementById('lightbox-next-btn');
        const lightboxDescription = document.getElementById('lightbox-description');
        const lightboxCounter = document.getElementById('lightbox-counter');
        const lightboxThumbnailsContainer = document.getElementById('lightbox-thumbnails');
        const lightboxZoomInBtn = document.getElementById('lightbox-zoom-in');
        const lightboxZoomOutBtn = document.getElementById('lightbox-zoom-out');
        const lightboxFullscreenBtn = document.getElementById('lightbox-fullscreen');

        // --- INITIALIZE SWIPER GALLERY ---
        function initializeGallery() {
            // Clear existing content
            mainImageWrapper.innerHTML = '';
            mainThumbnailsWrapper.innerHTML = '';

            // Create slides for both sliders
            galleryData.forEach(item => {
                // Main image slide
                const mainSlide = document.createElement('div');
                mainSlide.className = 'swiper-slide';
                mainSlide.innerHTML = `<img src="${item.main}" alt="${item.description}" class="w-full h-auto object-cover rounded-lg" onerror="this.onerror=null;this.src='https://placehold.co/600x600/f8f8f8/ccc?text=Image+Error';">`;
                mainImageWrapper.appendChild(mainSlide);

                // Thumbnail slide
                const thumbSlide = document.createElement('div');
                thumbSlide.className = 'swiper-slide relative'; // Added relative for overlay
                let thumbContent = `<img src="${item.thumb}" alt="Thumbnail for ${item.description}" onerror="this.onerror=null;this.src='https://placehold.co/120x120/f8f8f8/ccc?text=Error';">`;
                
                // Add overlay for video or 360 icons
                if (item.type !== 'image') {
                    let iconSvg = '';
                    if (item.type === 'video') {
                        iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>`;
                    } else if (item.type === '360') {
                        iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-white"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.664 0l3.181-3.183m-11.664 0l4.992-4.993m-14.976 0h4.992m-4.993 0l3.181-3.183a8.25 8.25 0 0111.664 0l3.181 3.183" /></svg>`;
                    }
                    thumbContent += `<div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center rounded-sm">${iconSvg}</div>`;
                }
                thumbSlide.innerHTML = thumbContent;
                mainThumbnailsWrapper.appendChild(thumbSlide);
            });

            // Initialize Swiper for thumbnails
            var galleryThumbs = new Swiper('.gallery-thumbs', {
                spaceBetween: 10,
                slidesPerView: 5,
                freeMode: true,
                watchSlidesProgress: true,
                navigation: {
                    nextEl: '#thumb-next-btn',
                    prevEl: '#thumb-prev-btn',
                },
            });

            // Initialize Swiper for the main image and link it with thumbnails
            var galleryTop = new Swiper('.gallery-top', {
                spaceBetween: 10,
                thumbs: {
                    swiper: galleryThumbs,
                },
            });

            // Add a click listener to the main slider to open the lightbox
            galleryTop.on('click', function () {
                openLightbox(galleryTop.activeIndex);
            });
        }

        // --- LIGHTBOX LOGIC ---
        let isZoomed = false;
        let isPanning = false;
        let startX, startY;
        let currentTranslateX = 0;
        let currentTranslateY = 0;

        function resetZoomState() {
            isZoomed = false;
            isPanning = false;
            currentTranslateX = 0;
            currentTranslateY = 0;
            lightboxMainImage.style.transition = 'transform 0.3s ease';
            lightboxMainImage.style.transform = 'scale(1) translate(0, 0)';
            lightboxMainImage.style.cursor = 'zoom-in';
        }
        
        function zoomIn() {
            isZoomed = true;
            lightboxMainImage.style.transition = 'transform 0.3s ease';
            lightboxMainImage.style.transform = 'scale(2.5)';
            lightboxMainImage.style.cursor = 'grab';
        }

        function zoomOut() {
            resetZoomState();
        }

        function updateLightboxView() {
            const item = galleryData[currentImageIndex];
            lightboxMainImage.src = item.lightbox;
            lightboxDescription.textContent = item.description;
            lightboxCounter.textContent = `${currentImageIndex + 1} / ${galleryData.length}`;
            
            resetZoomState();

            const lightboxThumbs = lightboxThumbnailsContainer.querySelectorAll('img');
            lightboxThumbs.forEach((thumb, i) => {
                thumb.classList.toggle('ring-2', i === currentImageIndex);
                thumb.classList.toggle('ring-white', i === currentImageIndex);
                thumb.classList.toggle('opacity-60', i !== currentImageIndex);
            });
        }
        
        function openLightbox(index) {
            currentImageIndex = index;
            populateLightboxThumbnails();
            updateLightboxView();
            lightboxModal.classList.remove('hidden');
            lightboxModal.classList.add('flex');
        }

        function closeLightbox() {
            lightboxModal.classList.add('hidden');
            lightboxModal.classList.remove('flex');
             if (document.fullscreenElement) {
                 document.exitFullscreen();
             }
             resetZoomState();
        }

        function showNextImage() {
            currentImageIndex = (currentImageIndex + 1) % galleryData.length;
            updateLightboxView();
        }

        function showPrevImage() {
            currentImageIndex = (currentImageIndex - 1 + galleryData.length) % galleryData.length;
            updateLightboxView();
        }

        function populateLightboxThumbnails() {
            if (lightboxThumbnailsContainer.children.length > 0) return;
            galleryData.forEach((item, index) => {
                const img = document.createElement('img');
                img.src = item.thumb;
                img.className = 'w-16 h-16 object-cover rounded-md cursor-pointer hover:opacity-100 transition-opacity';
                img.onclick = () => {
                    currentImageIndex = index;
                    updateLightboxView();
                };
                lightboxThumbnailsContainer.appendChild(img);
            });
        }

        // --- LIGHTBOX EVENT LISTENERS ---
        closeLightboxBtn.addEventListener('click', closeLightbox);
        lightboxNextBtn.addEventListener('click', showNextImage);
        lightboxPrevBtn.addEventListener('click', showPrevImage);
        
        lightboxZoomInBtn.addEventListener('click', zoomIn);
        lightboxZoomOutBtn.addEventListener('click', zoomOut);
        
        lightboxMainImage.addEventListener('dblclick', (e) => {
            e.preventDefault();
            if (isZoomed) {
                zoomOut();
            } else {
                zoomIn();
            }
        });

        lightboxMainImage.addEventListener('mousedown', (e) => {
            if (!isZoomed || isPanning) return;
            e.preventDefault();
            isPanning = true;
            startX = e.clientX - currentTranslateX;
            startY = e.clientY - currentTranslateY;
            lightboxMainImage.style.cursor = 'grabbing';
            lightboxMainImage.style.transition = 'none';
        });

        lightboxMainImage.addEventListener('mousemove', (e) => {
            if (!isPanning) return;
            e.preventDefault();
            currentTranslateX = e.clientX - startX;
            currentTranslateY = e.clientY - startY;
            lightboxMainImage.style.transform = `translate(${currentTranslateX}px, ${currentTranslateY}px) scale(2.5)`;
        });
        
        const endPan = (e) => {
            if (!isPanning) return;
            isPanning = false;
            lightboxMainImage.style.cursor = 'grab';
        };

        lightboxMainImage.addEventListener('mouseup', endPan);
        lightboxMainImage.addEventListener('mouseleave', endPan);

        lightboxFullscreenBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                lightboxModal.requestFullscreen().catch(err => {
                    // Use a custom modal/toast instead of alert in a real app
                    console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                });
            } else {
                document.exitFullscreen();
            }
        });

        document.addEventListener('keydown', (e) => {
            if (lightboxModal.classList.contains('hidden')) return;
            if (e.key === 'ArrowRight') showNextImage();
            if (e.key === 'ArrowLeft') showPrevImage();
            if (e.key === 'Escape') closeLightbox();
        });

        // --- STICKY BAR & VARIANT SELECTION ---
        function updateStickyBarInfo() {
            const selectedStorage = document.querySelector('.variant-selected')?.textContent || '256GB';
            const selectedColor = document.getElementById('colorName')?.textContent || 'Titan Tự nhiên';
            const stickyInfoEl = document.getElementById('sticky-bar-variant-info');
            if (stickyInfoEl) {
                stickyInfoEl.textContent = `Phân loại: ${selectedStorage}, ${selectedColor}`;
            }
        }

        window.selectColor = function(element, colorName) {
            const colorButtons = document.querySelectorAll('.variants div button[style]');
            colorButtons.forEach(btn => {
                btn.classList.remove('ring-blue-500');
                btn.classList.add('ring-transparent');
            });
            element.classList.remove('ring-transparent');
            element.classList.add('ring-blue-500');
            document.getElementById('colorName').textContent = colorName;
            updateStickyBarInfo();
        }

        window.selectVariant = function(element) {
            const variantButtons = document.querySelectorAll('.variants div button:not([style])');
            variantButtons.forEach(btn => {
                btn.classList.remove('variant-selected');
                btn.classList.add('border-gray-300', 'text-gray-700', 'hover:border-blue-500');
            });
            element.classList.add('variant-selected');
            element.classList.remove('border-gray-300', 'text-gray-700', 'hover:border-blue-500');
            updateStickyBarInfo();
        }
        
        // --- QUANTITY SELECTOR ---
        const minusBtn = document.getElementById('minusBtn'); const plusBtn = document.getElementById('plusBtn'); const quantityInput = document.getElementById('quantityInput');
        minusBtn.addEventListener('click', () => { let currentValue = parseInt(quantityInput.value); if (currentValue > 1) { quantityInput.value = currentValue - 1; } });
        plusBtn.addEventListener('click', () => { let currentValue = parseInt(quantityInput.value); quantityInput.value = currentValue + 1; });
        
        // --- SPECS ACCORDION ---
        const accordionButtons = document.querySelectorAll('.accordion-button');
        accordionButtons.forEach(button => { button.addEventListener('click', () => { const content = button.nextElementSibling; const icon = button.querySelector('.accordion-icon'); if (content.style.maxHeight) { content.style.maxHeight = null; icon.classList.remove('rotate-180'); } else { content.style.maxHeight = content.scrollHeight + 'px'; icon.classList.add('rotate-180'); } }); });
        
        // --- TABS & READ MORE ---
        const tabDescBtn = document.getElementById('tab-desc-btn');
        const tabSpecsBtn = document.getElementById('tab-specs-btn');
        const tabDescContent = document.getElementById('tab-desc-content');
        const tabSpecsContent = document.getElementById('tab-specs-content');
        const descriptionWrapper = document.getElementById('description-wrapper');
        const readMoreBtn = document.getElementById('read-more-btn');

        tabSpecsContent.style.display = 'block';
        tabDescContent.style.display = 'none';
        tabSpecsBtn.classList.add('tab-active');
        tabDescBtn.classList.remove('tab-active');

        tabDescBtn.addEventListener('click', () => {
            tabDescContent.style.display = 'block';
            tabSpecsContent.style.display = 'none';
            tabDescBtn.classList.add('tab-active');
            tabSpecsBtn.classList.remove('tab-active');
        });

        tabSpecsBtn.addEventListener('click', () => {
            tabSpecsContent.style.display = 'block';
            tabDescContent.style.display = 'none';
            tabSpecsBtn.classList.add('tab-active');
            tabDescBtn.classList.remove('tab-active');
        });

        readMoreBtn.addEventListener('click', () => {
            if (descriptionWrapper.classList.contains('collapsed')) {
                descriptionWrapper.classList.remove('collapsed');
                readMoreBtn.textContent = 'Thu gọn';
            } else {
                descriptionWrapper.classList.add('collapsed');
                readMoreBtn.textContent = 'Xem thêm';
            }
        });

        // --- MODAL HELPER ---
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('.bg-white').classList.remove('scale-95');
            }, 10);
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            modal.classList.add('opacity-0');
            modal.querySelector('.bg-white').classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }, 300);
        }

        // --- COMPARE BUTTON ---
        const compareBtn = document.getElementById('compare-btn');
        compareBtn.addEventListener('click', () => {
             // Replace alert with a custom modal in a real application
            alert('Chức năng so sánh sẽ được tích hợp sau!');
        });
        
        // --- FAVORITE BUTTON ---
        const favoriteBtn = document.getElementById('favorite-btn');
        const favoriteIconContainer = document.getElementById('favorite-icon-container');
        const outlineIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.5l1.318-1.182a4.5 4.5 0 116.364 6.364L12 21l-7.682-7.318a4.5 4.5 0 010-6.364z" /></svg>`;
        const solidIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" /></svg>`;
        favoriteBtn.addEventListener('click', () => {
            const isFavorited = favoriteBtn.classList.toggle('favorited');
            favoriteIconContainer.innerHTML = isFavorited ? solidIcon : outlineIcon;
        });

        // --- SHARE POPOVER ---
        const shareBtn = document.getElementById('share-btn');
        const sharePopover = document.getElementById('share-popover');
        const copyLinkBtn = document.getElementById('copy-link-btn');
        shareBtn.addEventListener('click', (event) => {
            event.stopPropagation();
            sharePopover.classList.toggle('hidden');
        });
        copyLinkBtn.addEventListener('click', () => {
            const url = window.location.href;
            const textarea = document.createElement('textarea');
            textarea.value = url;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            copyLinkBtn.textContent = 'Đã sao chép!';
            setTimeout(() => { copyLinkBtn.textContent = 'Sao chép link'; }, 2000);
        });
        document.addEventListener('click', (event) => {
            if (!shareBtn.contains(event.target) && !sharePopover.contains(event.target)) {
                sharePopover.classList.add('hidden');
            }
        });

        // --- COUNTDOWN TIMER ---
        const countdownDate = new Date().getTime() + (2 * 60 * 60 * 1000); // Set timer for 2 hours from now
        const timerInterval = setInterval(() => {
            const now = new Date().getTime();
            const distance = countdownDate - now;
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            document.getElementById('hours').innerText = hours.toString().padStart(2, '0');
            document.getElementById('minutes').innerText = minutes.toString().padStart(2, '0');
            document.getElementById('seconds').innerText = seconds.toString().padStart(2, '0');
            if (distance < 0) { clearInterval(timerInterval); document.getElementById('countdown-timer').innerHTML = "<span class='text-sm'>Đã kết thúc</span>"; }
        }, 1000);

        // --- BUNDLE DEAL ---
        const bundleCheckboxes = document.querySelectorAll('.bundle-checkbox');
        const bundleTotalPriceEl = document.getElementById('bundle-total-price');
        const basePrice = 30490000;
        function calculateBundleTotal() {
            let total = basePrice;
            bundleCheckboxes.forEach(checkbox => { if (checkbox.checked) { total += parseInt(checkbox.dataset.price); } });
            bundleTotalPriceEl.textContent = total.toLocaleString('vi-VN') + '₫';
        }
        bundleCheckboxes.forEach(checkbox => checkbox.addEventListener('change', calculateBundleTotal));
        
        // --- COMMENT TEXTAREA & CHAR COUNTER ---
        const commentTextarea = document.getElementById('comment-textarea');
        const charCounter = document.getElementById('char-counter');
        const maxLength = commentTextarea.getAttribute('maxlength');
        commentTextarea.addEventListener('input', () => {
            const currentLength = commentTextarea.value.length;
            charCounter.textContent = `${currentLength}/${maxLength}`;
        });

        // --- REVIEW MODAL ---
        const writeReviewBtn = document.getElementById('write-review-btn');
        const reviewModal = document.getElementById('review-modal');
        const closeReviewModalBtn = document.getElementById('close-review-modal-btn');
        const reviewStarsContainer = document.getElementById('review-stars-container');
        let selectedRating = 0;

        for (let i = 1; i <= 5; i++) {
            const star = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            star.setAttribute('class', 'review-star w-8 h-8');
            star.setAttribute('fill', 'currentColor');
            star.setAttribute('viewBox', '0 0 20 20');
            star.innerHTML = `<path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>`;
            star.dataset.rating = i;
            reviewStarsContainer.appendChild(star);
        }
        const reviewStars = reviewStarsContainer.querySelectorAll('.review-star');
        reviewStars.forEach(star => {
            star.addEventListener('mouseover', () => reviewStars.forEach(s => s.classList.toggle('hover', s.dataset.rating <= star.dataset.rating)));
            star.addEventListener('mouseout', () => reviewStars.forEach(s => s.classList.remove('hover')));
            star.addEventListener('click', () => { selectedRating = star.dataset.rating; reviewStars.forEach(s => s.classList.toggle('selected', s.dataset.rating <= selectedRating)); });
        });
        writeReviewBtn.addEventListener('click', () => showModal('review-modal'));
        closeReviewModalBtn.addEventListener('click', () => hideModal('review-modal'));
        reviewModal.addEventListener('click', (event) => { if (event.target === reviewModal) hideModal('review-modal'); });

        // --- USER INFO MODAL ---
        const userInfoModal = document.getElementById('user-info-modal');
        const closeUserInfoModalBtn = document.getElementById('close-user-info-modal-btn');
        closeUserInfoModalBtn.addEventListener('click', () => hideModal('user-info-modal'));
        userInfoModal.addEventListener('click', (event) => { if (event.target === userInfoModal) hideModal('user-info-modal'); });

        const termsCheckbox = document.getElementById('terms-checkbox');
        const qnaCompleteBtn = document.getElementById('qna-complete-btn');
        termsCheckbox.addEventListener('change', () => {
            if (termsCheckbox.checked) {
                qnaCompleteBtn.disabled = false;
                qnaCompleteBtn.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                qnaCompleteBtn.classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-700');
            } else {
                qnaCompleteBtn.disabled = true;
                qnaCompleteBtn.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                qnaCompleteBtn.classList.remove('bg-blue-600', 'text-white', 'hover:bg-blue-700');
            }
        });

        // --- DUMMY DATA ---
        const qnaData = [
            { q: 'Sản phẩm này có hỗ trợ eSIM không?', a: 'Chào bạn, iPhone 15 Pro Max bản VN/A chính hãng hỗ trợ 1 SIM vật lý và nhiều eSIM nhé.' },
            { q: 'Chế độ bảo hành như thế nào?', a: 'Sản phẩm được bảo hành chính hãng 12 tháng tại các trung tâm bảo hành uỷ quyền của Apple trên toàn quốc ạ.' },
            { q: 'Phụ kiện đi kèm có những gì?', a: 'Dạ trong hộp sản phẩm có máy, cáp sạc USB-C và sách hướng dẫn sử dụng ạ.' },
            { q: 'Máy có chống nước không?', a: 'Chào bạn, iPhone 15 Pro Max có chuẩn kháng nước, bụi IP68, có thể chịu được ở độ sâu tối đa 6 mét trong tối đa 30 phút ạ.' },
            { q: 'Cổng sạc Type-C có nhanh hơn Lightning không?', a: 'Dạ, cổng USB-C trên iPhone 15 Pro và Pro Max hỗ trợ tốc độ USB 3, nhanh hơn đến 20 lần so với cổng Lightning (USB 2.0) khi truyền dữ liệu bằng cáp tương thích ạ.' },
        ];

        const reviewData = [
            { 
                name: 'Nguyễn V. An', 
                avatar: 'https://placehold.co/40x40/7e22ce/ffffff?text=N',
                rating: 5,
                text: 'Sản phẩm tuyệt vời, đúng hàng chính hãng. Giao hàng nhanh, đóng gói cẩn thận. Máy mượt, pin trâu, chụp ảnh siêu nét. Rất đáng tiền!',
                images: ['https://placehold.co/80x80/d0d0d0/333?text=Ảnh+thật', 'https://placehold.co/80x80/c0c0c0/333?text=Ảnh+thật'],
                date: '2 ngày trước'
            },
            { 
                name: 'Trần B. Tuấn', 
                avatar: 'https://placehold.co/40x40/34d399/ffffff?text=T',
                rating: 4,
                text: 'Máy dùng tốt, tuy nhiên thời lượng pin không như kỳ vọng của mình lắm. Camera chụp đêm khá ổn. Màn hình ProMotion rất mượt.',
                images: [],
                date: '1 tuần trước'
            },
            { 
                name: 'Lê Thị Cẩm', 
                avatar: 'https://placehold.co/40x40/f87171/ffffff?text=C',
                rating: 5,
                text: 'Màu Titan tự nhiên ở ngoài đẹp hơn trong ảnh nhiều. Shop tư vấn nhiệt tình. Sẽ ủng hộ lần sau.',
                images: [],
                date: '3 tuần trước'
            }
        ];

        // --- GEMINI API INTEGRATION ---
        const summarizeBtn = document.getElementById('summarize-reviews-btn');
        const reviewSummaryContainer = document.getElementById('review-summary-container');
        const askAiBtn = document.getElementById('ask-ai-btn');
        const aiAnswerContainer = document.getElementById('ai-answer-container');
        const qnaTextarea = document.getElementById('qna-textarea');
        const commentSubmitBtn = document.getElementById('comment-submit-btn');

        // Generic function to call Gemini API
        async function callGemini(prompt) {
            const apiKey = ""; // Leave empty
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{
                    role: "user",
                    parts: [{ text: prompt }]
                }]
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    console.error("Unexpected API response structure:", result);
                    return "Rất tiếc, tôi không thể tạo phản hồi vào lúc này.";
                }
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                return "Đã xảy ra lỗi khi kết nối với AI. Vui lòng thử lại sau.";
            }
        }
        
        // Function to format AI summary into beautiful HTML
        function formatAiSummary(text) {
            const lines = text.split('\n').filter(line => line.trim() !== '');
            let html = '';
            let currentListType = null; // 'pros' or 'cons'

            lines.forEach(line => {
                line = line.replace(/\*\*/g, ''); // Remove bold markers
                if (line.toLowerCase().includes('ưu điểm')) {
                    if (currentListType) html += `</ul>`; // Close previous list if any
                    html += `<h4 class="text-lg font-semibold text-green-600 mb-2">Ưu điểm</h4><ul class="space-y-1 list-inside mb-4">`;
                    currentListType = 'pros';
                } else if (line.toLowerCase().includes('nhược điểm')) {
                    if (currentListType) html += `</ul>`; // Close previous list
                    html += `<h4 class="text-lg font-semibold text-red-600 mb-2">Nhược điểm</h4><ul class="space-y-1 list-inside">`;
                    currentListType = 'cons';
                } else if (line.trim().startsWith('*') || line.trim().startsWith('-')) {
                    const itemText = line.trim().substring(1).trim();
                    const icon = currentListType === 'pros' 
                        ? `<svg class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" /></svg>`
                        : `<svg class="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" /></svg>`;
                    html += `<li class="flex items-start gap-2 text-gray-700">${icon}<span>${itemText}</span></li>`;
                }
            });

            if (currentListType) html += `</ul>`; // Close the last list
            return html;
        }

        // Function to format AI Q&A answer
        function formatAiQnaAnswer(text) {
            const parts = text.split('\n').filter(p => p.trim() !== '');
            let html = `<p class="mb-3">${parts[0]}</p>`;
            html += '<ul class="space-y-2">';
            parts.slice(1).forEach(part => {
                const itemText = part.replace(/^\s*[\*\-]\s*/, '').replace(/\*\*(.*?)\*\*/g, '<span class="font-semibold text-gray-800">$1</span>');
                html += `<li class="flex items-start gap-2 text-gray-700">
                                 <svg class="w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" /></svg>
                                 <span>${itemText}</span>
                               </li>`;
            });
            html += '</ul>';
            return html;
        }

        // 1. Review Summarizer
        summarizeBtn.addEventListener('click', async () => {
            reviewSummaryContainer.innerHTML = '<div class="flex items-center justify-center gap-2 text-gray-600"><div class="loader"></div><span>AI đang tóm tắt, vui lòng chờ...</span></div>';
            reviewSummaryContainer.classList.remove('hidden');

            const reviewsText = reviewData.map(review => review.text).join('\n- ');
            const prompt = `Dựa trên các đánh giá sau đây về sản phẩm iPhone 15 Pro Max, hãy tóm tắt các ưu điểm và nhược điểm chính được đề cập. Trình bày dưới dạng "**Ưu điểm:**" và "**Nhược điểm:**", với mỗi ý là một gạch đầu dòng bắt đầu bằng dấu *. \n\nĐánh giá:\n- ${reviewsText}`;
            
            const summaryText = await callGemini(prompt);
            reviewSummaryContainer.innerHTML = formatAiSummary(summaryText);
        });

        // 2. Q&A Assistant
        askAiBtn.addEventListener('click', async () => {
            const question = qnaTextarea.value.trim();
            if (!question) {
                alert('Vui lòng nhập câu hỏi của bạn.');
                return;
            }

            aiAnswerContainer.innerHTML = '<div class="flex items-center gap-2 text-gray-600"><div class="loader"></div><span>AI đang suy nghĩ, vui lòng chờ...</span></div>';
            aiAnswerContainer.classList.remove('hidden');

            const productTitle = document.querySelector('h1').innerText;
            const productDescription = document.querySelector('#description-wrapper')?.innerText || '';
            const promotions = Array.from(document.querySelectorAll('.promotions li')).map(li => li.innerText).join(', ');
            const specs = Array.from(document.querySelectorAll('#specs-accordion dl')).map(dl => dl.innerText).join('\n');

            const context = `Thông tin sản phẩm: ${productTitle}.\nMô tả: ${productDescription}\nThông số kỹ thuật: ${specs}\nKhuyến mãi: ${promotions}\nCác câu hỏi đã có: ${JSON.stringify(qnaData)}`;
            const prompt = `Bạn là một trợ lý bán hàng am hiểu về sản phẩm. Dựa vào thông tin sau:\n\n${context}\n\nHãy trả lời câu hỏi của khách hàng một cách ngắn gọn, thân thiện và chính xác. Chỉ sử dụng thông tin được cung cấp. Nếu không có thông tin, hãy nói rằng bạn không có thông tin đó. Định dạng câu trả lời với một câu chào và sau đó là các gạch đầu dòng.\n\nCâu hỏi của khách hàng: "${question}"`;
            
            const answer = await callGemini(prompt);
            aiAnswerContainer.innerHTML = formatAiQnaAnswer(answer);
        });

        // --- COMMENT SUBMIT ---
        commentSubmitBtn.addEventListener('click', () => {
            const commentText = document.getElementById('comment-textarea').value;
            if (commentText.trim() === '') {
                alert('Vui lòng nhập bình luận của bạn.');
                return;
            }
            showModal('user-info-modal');
        });
        
        // --- REVIEW PAGINATION ---
        const reviewListEl = document.getElementById('review-list');
        const reviewPaginationEl = document.getElementById('review-pagination');
        let reviewCurrentPage = 1;
        const reviewItemsPerPage = 2;

        function renderReviews() {
            reviewListEl.innerHTML = '';
            const start = (reviewCurrentPage - 1) * reviewItemsPerPage;
            const end = start + reviewItemsPerPage;
            const paginatedItems = reviewData.slice(start, end);

            for (const item of paginatedItems) {
                const reviewItem = document.createElement('div');
                reviewItem.className = 'border-b border-gray-200 py-4 review-item';
                let imagesHTML = '';
                if(item.images.length > 0) {
                    imagesHTML = `<div class="flex gap-2 mt-2">${item.images.map(src => `<img src="${src}" alt="Review Image" class="w-20 h-20 rounded-md object-cover">`).join('')}</div>`;
                }
                reviewItem.innerHTML = `
                    <div class="flex items-start gap-3">
                        <img src="${item.avatar}" alt="Avatar" class="w-10 h-10 rounded-full">
                        <div>
                            <p class="font-semibold text-gray-800">${item.name}</p>
                            <div class="flex text-yellow-400 text-sm my-1">${'★'.repeat(item.rating)}${'☆'.repeat(5 - item.rating)}</div>
                            <p class="text-sm text-gray-600 review-text">${item.text}</p>
                            ${imagesHTML}
                            <div class="text-xs text-gray-500 mt-2 flex items-center gap-4"><span>${item.date}</span><button class="flex items-center gap-1 text-blue-600 hover:underline"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"></path></svg>Hữu ích</button></div>
                        </div>
                    </div>
                `;
                reviewListEl.appendChild(reviewItem);
            }
        }

        function setupReviewPagination() {
            reviewPaginationEl.innerHTML = '';
            const pageCount = Math.ceil(reviewData.length / reviewItemsPerPage);
            for (let i = 1; i <= pageCount; i++) {
                const btn = document.createElement('button');
                btn.innerText = i;
                btn.className = `px-3 py-1 mx-1 rounded-md text-sm font-medium ${i === reviewCurrentPage ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`;
                btn.addEventListener('click', () => {
                    reviewCurrentPage = i;
                    renderReviews();
                    setupReviewPagination();
                });
                reviewPaginationEl.appendChild(btn);
            }
        }


        // --- RENDER DUMMY Q&A DATA ---
        const qnaListEl = document.getElementById('qna-list');
        const qnaPaginationEl = document.getElementById('qna-pagination');
        let qnaCurrentPage = 1;
        const qnaItemsPerPage = 3;

        function renderQna() {
            qnaListEl.innerHTML = '';
            const start = (qnaCurrentPage - 1) * qnaItemsPerPage;
            const end = start + qnaItemsPerPage;
            const paginatedItems = qnaData.slice(start, end);

            for (const item of paginatedItems) {
                const qnaItem = document.createElement('div');
                qnaItem.className = 'faq-item border-t border-gray-200 pt-4';
                qnaItem.innerHTML = `
                    <p class="font-semibold text-gray-800">Q: ${item.q}</p>
                    <p class="text-sm text-gray-600 mt-1 pl-4 border-l-2 border-blue-200">A: ${item.a}</p>
                `;
                qnaListEl.appendChild(qnaItem);
            }
        }

        function setupQnaPagination() {
            qnaPaginationEl.innerHTML = '';
            const pageCount = Math.ceil(qnaData.length / qnaItemsPerPage);
            for (let i = 1; i <= pageCount; i++) {
                const btn = document.createElement('button');
                btn.innerText = i;
                btn.className = `px-3 py-1 mx-1 rounded-md text-sm font-medium ${i === qnaCurrentPage ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`;
                btn.addEventListener('click', () => {
                    qnaCurrentPage = i;
                    renderQna();
                    setupQnaPagination();
                });
                qnaPaginationEl.appendChild(btn);
            }
        }
        
        // --- STICKY BAR OBSERVER ---
        const stickyBar = document.getElementById('sticky-bar');
        const mainCtaButtons = document.getElementById('main-cta-buttons');
        
        const scrollObserver = new IntersectionObserver((entries) => {
            if (!entries[0].isIntersecting) {
                stickyBar.classList.remove('translate-y-full');
            } else {
                stickyBar.classList.add('translate-y-full');
            }
        }, { threshold: 0 });
        
        if(mainCtaButtons) {
            scrollObserver.observe(mainCtaButtons);
        }

        // --- STORE LOCATOR SWIPER ---
        new Swiper('#store-swiper', {
            slidesPerView: 'auto',
            spaceBetween: 12, // Corresponds to gap-3
            freeMode: true,
            navigation: {
                nextEl: '#store-next-btn',
                prevEl: '#store-prev-btn',
            },
            on: {
                init: function () {
                    const container = this.el.parentElement;
                    if (this.isLocked) {
                        container.classList.add('navigation-hidden');
                    } else {
                        container.classList.remove('navigation-hidden');
                    }
                },
                resize: function () {
                    const container = this.el.parentElement;
                    if (this.isLocked) {
                        container.classList.add('navigation-hidden');
                    } else {
                        container.classList.remove('navigation-hidden');
                    }
                }
            }
        });


        // --- INITIALIZE ALL ---
        initializeGallery();
        calculateBundleTotal();
        renderQna();
        setupQnaPagination();
        renderReviews();
        setupReviewPagination();
        updateStickyBarInfo(); // Initial call to set variant info
    });
    </script>

</body>
</html>
