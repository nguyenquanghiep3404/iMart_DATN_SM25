<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPhone 15 Pro Max 256GB | Titan Tự nhiên</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Heroicons for Icons -->
    <script src="https://unpkg.com/heroicons@2.1.3/24/outline/index.js"></script>

    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb; /* Light gray background */
        }
        
        .thumbnail-selected {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        }

        .variant-selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
            color: #2563eb;
        }

        .carousel::-webkit-scrollbar { display: none; }
        .carousel { -ms-overflow-style: none; scrollbar-width: none; }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .accordion-icon {
            transition: transform 0.3s ease;
        }

        /* Tab Styles */
        .tab-button {
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease-in-out;
        }
        .tab-active {
            border-color: #3b82f6; /* blue-500 */
            color: #2563eb; /* blue-600 */
            background-color: #eff6ff; /* blue-50 */
        }
        
        /* Read More styles */
        .description-content.collapsed {
            max-height: 300px;
            overflow: hidden;
            position: relative;
        }
        .description-content.collapsed::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: linear-gradient(to top, white, rgba(255,255,255,0));
        }
        
        /* Favorite button style */
        #favorite-btn.favorited {
            color: #ef4444; /* red-500 */
        }
        
        /* Review Stars */
        .review-star {
            color: #d1d5db; /* gray-300 */
            cursor: pointer;
            transition: color 0.2s;
        }
        .review-star.hover, .review-star.selected {
            color: #f59e0b; /* amber-500 */
        }
        
        /* Off-canvas modal style */
        #user-info-modal.open {
            transform: translateX(0);
        }
        #user-info-modal-overlay.open {
            opacity: 1;
        }
        
        /* Sticky Add to Cart Bar */
        #sticky-bar {
            transition: transform 0.3s ease-in-out;
        }
        
        /* Lightbox zoom */
        #lightbox-main-image {
            transition: transform 0.3s ease;
            cursor: zoom-in;
        }
        #lightbox-main-image.zoomed {
            transform: scale(2);
            cursor: zoom-out;
        }


    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto p-4 md:p-8">
        <!-- Main Product Section -->
        <main class="bg-white p-4 sm:p-6 md:p-8 rounded-xl shadow-sm">
            <!-- Breadcrumb -->
            <nav class="text-sm text-gray-500 mb-4">
                <a href="#" class="hover:underline">Trang chủ</a> &gt;
                <a href="#" class="hover:underline">Điện thoại</a> &gt;
                <a href="#" class="hover:underline">Apple</a> &gt;
                <span class="font-medium text-gray-700">iPhone 15 Pro Max 256GB</span>
            </nav>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12">
                <!-- PHẦN 1: CỘT TRÁI - THƯ VIỆN HÌNH ẢNH -->
                <div class="image-gallery">
                    <div id="main-image-container" class="group rounded-lg border border-gray-200 relative cursor-pointer">
                        <img id="mainImage" src="https://placehold.co/600x600/f0f0f0/333?text=iPhone+15+Pro" alt="iPhone 15 Pro Max - Ảnh chính" class="w-full h-auto object-cover rounded-lg">
                        
                        <!-- Prev Button -->
                        <button id="gallery-prev-btn" class="absolute left-3 top-1/2 -translate-y-1/2 bg-white/70 p-2 rounded-full shadow-md opacity-0 group-hover:opacity-100 transition-opacity z-10">
                            <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </button>

                        <!-- Next Button -->
                        <button id="gallery-next-btn" class="absolute right-3 top-1/2 -translate-y-1/2 bg-white/70 p-2 rounded-full shadow-md opacity-0 group-hover:opacity-100 transition-opacity z-10">
                            <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                    </div>
                    <div id="main-thumbnails" class="grid grid-cols-5 gap-2 mt-4">
                        <!-- Thumbnails will be generated by JS -->
                    </div>
                </div>

                <!-- PHẦN 1: CỘT PHẢI - THÔNG TIN & HÀNH ĐỘNG -->
                <div class="product-info flex flex-col">
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-900">iPhone 15 Pro Max 256GB | Titan Tự nhiên | Chính hãng VN/A</h1>
                    
                    <div class="flex items-center flex-wrap gap-4 mt-2">
                        <span class="inline-flex items-center bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-0.5 rounded-full w-fit">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mr-1"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" /></svg>
                          Chính hãng
                        </span>
                        <button id="compare-btn" class="flex items-center gap-1.5 text-sm font-semibold text-blue-600 hover:text-blue-800">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                              <path d="M5 4a1 1 0 00-2 0v7.268a2 2 0 000 3.464V16a1 1 0 102 0v-1.268a2 2 0 000-3.464V4zM11 4a1 1 0 10-2 0v1.268a2 2 0 000 3.464V16a1 1 0 102 0V8.732a2 2 0 000-3.464V4zM16 3a1 1 0 011 1v7.268a2 2 0 010 3.464V16a1 1 0 11-2 0v-1.268a2 2 0 010-3.464V4a1 1 0 011-1z" />
                            </svg>
                            So sánh
                        </button>
                        <button id="favorite-btn" class="flex items-center gap-1.5 text-sm font-semibold text-gray-500 hover:text-red-500 transition-colors">
                            <span id="favorite-icon-container">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.5l1.318-1.182a4.5 4.5 0 116.364 6.364L12 21l-7.682-7.318a4.5 4.5 0 010-6.364z" />
                                </svg>
                            </span>
                            <span>Yêu thích</span>
                        </button>
                        <div class="relative">
                            <button id="share-btn" class="flex items-center gap-1.5 text-sm font-semibold text-gray-500 hover:text-blue-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" />
                                </svg>
                                <span>Chia sẻ</span>
                            </button>
                            <div id="share-popover" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-xl z-20 hidden">
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Facebook</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Twitter</a>
                                <button id="copy-link-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Sao chép link</button>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center gap-3 mt-3 text-sm text-gray-600">
                        <div class="flex items-center gap-1"><span class="font-bold text-yellow-500">4.9</span><div class="flex text-yellow-400">★★★★☆</div></div>
                        <div class="h-4 w-px bg-gray-300"></div><span><span class="font-semibold">1,258</span> đánh giá</span>
                        <div class="h-4 w-px bg-gray-300"></div><span><span class="font-semibold">4.6k</span> đã bán</span>
                    </div>
                    
                    <!-- Permanent Price Block -->
                    <div class="price-block bg-gray-100 p-4 rounded-lg mt-4">
                        <div class="flex items-baseline gap-3">
                            <span class="text-3xl font-bold text-red-600">32.790.000₫</span>
                            <span class="text-lg text-gray-500 line-through">34.990.000₫</span>
                            <span class="bg-red-200 text-red-800 text-sm font-semibold px-2 py-0.5 rounded-md">-6%</span>
                        </div>
                    </div>

                    <div class="promotions mt-6">
                        <h3 class="font-semibold text-gray-800 mb-2">Khuyến mãi & Ưu đãi</h3>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-start gap-2 text-gray-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>Giảm thêm <span class="font-bold">500.000₫</span> khi thanh toán qua VNPAY.</span></li>
                            <li class="flex items-start gap-2 text-gray-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c1.657 0 3-1.343 3-3S13.657 2 12 2 9 3.343 9 5s1.343 3 3 3zm0 0v1m0-1c-1.657 0-3 1.343-3 3S10.343 11 12 11s3-1.343 3-3-1.343-3-3-3zm0 0c1.657 0 3 1.343 3 3s-1.343 3-3 3m0 0v7m0-7c-1.657 0-3 1.343-3 3s1.343 3 3 3"></path></svg><span>Tặng <span class="font-bold">Ốp lưng MagSafe</span> trị giá 1.200.000₫.</span></li>
                            <li class="flex items-start gap-2 text-gray-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg><span>Hỗ trợ <span class="font-bold">trả góp 0%</span> qua thẻ tín dụng.</span></li>
                        </ul>
                    </div>
                    <div class="variants mt-6 space-y-4">
                         <div>
                            <h4 class="font-medium text-gray-800 mb-2">Dung lượng</h4>
                            <div class="flex gap-2 flex-wrap">
                                <button class="px-4 py-2 border-2 rounded-lg text-sm font-semibold variant-selected" onclick="selectVariant(this)">256GB</button>
                                <button class="px-4 py-2 border-2 border-gray-300 rounded-lg text-sm font-semibold text-gray-700 hover:border-blue-500" onclick="selectVariant(this)">512GB</button>
                                <button class="px-4 py-2 border-2 border-gray-300 rounded-lg text-sm font-semibold text-gray-700 hover:border-blue-500" onclick="selectVariant(this)">1TB</button>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-800 mb-2">Màu sắc: <span id="colorName" class="font-bold">Titan Tự nhiên</span></h4>
                            <div class="flex gap-2">
                                <button class="w-8 h-8 rounded-full bg-gray-300 ring-2 ring-blue-500 ring-offset-1 focus:outline-none" style="background-color: #8A8A8D;" onclick="selectColor(this, 'Titan Tự nhiên')"></button>
                                <button class="w-8 h-8 rounded-full bg-blue-900 ring-2 ring-transparent ring-offset-1 focus:outline-none" style="background-color: #2E3A48;" onclick="selectColor(this, 'Titan Xanh')"></button>
                                <button class="w-8 h-8 rounded-full bg-white border border-gray-300 ring-2 ring-transparent ring-offset-1 focus:outline-none" style="background-color: #F5F5F7;" onclick="selectColor(this, 'Titan Trắng')"></button>
                                <button class="w-8 h-8 rounded-full bg-gray-800 ring-2 ring-transparent ring-offset-1 focus:outline-none" style="background-color: #4A4A4A;" onclick="selectColor(this, 'Titan Đen')"></button>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6"><h4 class="font-medium text-gray-800 mb-2">Số lượng</h4><div class="flex items-center border border-gray-300 rounded-lg w-fit"><button id="minusBtn" class="px-3 py-1 text-lg text-gray-600 hover:bg-gray-100 rounded-l-md">-</button><input id="quantityInput" type="text" value="1" class="w-12 text-center border-l border-r font-semibold text-gray-800 focus:outline-none"><button id="plusBtn" class="px-3 py-1 text-lg text-gray-600 hover:bg-gray-100 rounded-r-md">+</button></div></div>
                    <div id="main-cta-buttons" class="mt-auto pt-6 flex flex-col sm:flex-row gap-3">
                        <button class="flex-1 w-full flex items-center justify-center gap-2 px-6 py-3.5 border-2 border-blue-600 text-blue-600 font-bold rounded-lg hover:bg-blue-50 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c.51 0 .962-.343 1.087-.835l1.838-6.839a1.5 1.5 0 00-1.087-1.835H4.215" /></svg>THÊM VÀO GIỎ HÀNG</button>
                        <button class="flex-1 w-full px-6 py-4 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition-colors">MUA NGAY</button>
                    </div>
                     <div class="text-sm text-gray-500 mt-4 text-center sm:text-left"><span class="font-semibold">Giao hàng dự kiến:</span> Thứ Ba, 28/06 - Thứ Tư, 29/06.</div>
                </div>
            </div>
        </main>
        
        <!-- Sections below the fold -->
        <div class="mt-10 md:mt-12 space-y-10 md:space-y-12">
            
            <!-- Mua Kèm Deal Sốc / Cheaper Together -->
            <section class="bg-white p-6 md:p-8 rounded-xl shadow-sm">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Mua Kèm Deal Sốc</h2>
                <div class="flex flex-col lg:flex-row items-center justify-center gap-4" id="bundle-deal-container">
                    <!-- Main Product -->
                    <div class="flex flex-col items-center text-center p-4 border border-gray-200 rounded-lg">
                        <img src="https://placehold.co/150x150/f0f0f0/333?text=iPhone+15" class="w-32 h-32 object-contain mb-2">
                        <p class="font-semibold text-sm">iPhone 15 Pro Max</p>
                        <p class="font-bold text-red-600">32.790.000₫</p>
                    </div>

                    <div class="text-3xl font-light text-gray-400">+</div>

                    <!-- Bundle Item 1 -->
                    <div class="bundle-item flex flex-col items-center text-center p-4 border border-gray-200 rounded-lg relative">
                        <input type="checkbox" data-price="4490000" class="bundle-checkbox absolute top-2 right-2 h-5 w-5 rounded text-blue-600 focus:ring-blue-500" checked>
                        <img src="https://placehold.co/150x150/e0e0e0/333?text=AirPods" class="w-32 h-32 object-contain mb-2">
                        <p class="font-semibold text-sm">AirPods Pro 2</p>
                        <p class="font-bold text-red-600">4.490.000₫ <span class="text-gray-500 line-through text-xs">5.990.000₫</span></p>
                    </div>

                    <div class="text-3xl font-light text-gray-400">+</div>

                    <!-- Bundle Item 2 -->
                    <div class="bundle-item flex flex-col items-center text-center p-4 border border-gray-200 rounded-lg relative">
                        <input type="checkbox" data-price="890000" class="bundle-checkbox absolute top-2 right-2 h-5 w-5 rounded text-blue-600 focus:ring-blue-500">
                        <img src="https://placehold.co/150x150/d0d0d0/333?text=Sạc" class="w-32 h-32 object-contain mb-2">
                        <p class="font-semibold text-sm">Sạc nhanh 20W</p>
                        <p class="font-bold text-red-600">890.000₫ <span class="text-gray-500 line-through text-xs">1.200.000₫</span></p>
                    </div>

                    <div class="text-3xl font-light text-gray-400 hidden lg:block">=</div>

                    <!-- Total Price -->
                    <div class="mt-4 lg:mt-0 lg:ml-4 p-4 border-2 border-red-500 rounded-lg text-center">
                        <p class="font-semibold">Tổng giá trị:</p>
                        <p id="bundle-total-price" class="text-2xl font-bold text-red-600 my-2">35.870.000₫</p>
                        <button class="w-full bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700">Thêm tất cả vào giỏ</button>
                    </div>
                </div>
            </section>

            <!-- PHẦN 2 & 3: TABS - BÀI VIẾT & THÔNG SỐ -->
            <section class="bg-white p-6 md:p-8 rounded-xl shadow-sm">
                <!-- Tab Buttons -->
                <div class="flex justify-center border-2 border-gray-200 rounded-xl p-1 mb-6 max-w-md mx-auto">
                    <button id="tab-desc-btn" class="tab-button w-1/2 py-2.5 px-4 rounded-lg text-sm font-semibold text-gray-600">Bài viết đánh giá</button>
                    <button id="tab-specs-btn" class="tab-button w-1/2 py-2.5 px-4 rounded-lg text-sm font-semibold tab-active">Thông số kỹ thuật</button>
                </div>

                <!-- Tab Content -->
                <div>
                    <!-- Content for Description Tab -->
                    <div id="tab-desc-content" class="tab-content hidden">
                        <div id="description-wrapper" class="description-content collapsed">
                            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Đặc điểm nổi bật của iPhone 15 Pro Max</h2>
                            <div class="space-y-8 prose max-w-none">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                                    <div><h3 class="text-xl font-semibold text-gray-800 mb-2">Khung viền Titan chuẩn hàng không vũ trụ</h3><p class="text-gray-600 leading-relaxed">iPhone 15 Pro là iPhone đầu tiên có thiết kế từ titan chuẩn hàng không vũ trụ, sử dụng hợp kim tương tự như trong tàu vũ trụ cho các sứ mệnh Sao Hỏa. Chất liệu này mang lại độ bền vượt trội và giúp iPhone Pro mới trở thành phiên bản nhẹ nhất từ trước đến nay.</p></div>
                                    <img src="https://placehold.co/500x300/e0e0e0/333?text=Khung+Titan" alt="Khung viền Titan" class="rounded-lg w-full">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                                     <img src="https://placehold.co/500x300/d0d0d0/333?text=Chip+A17+Pro" alt="Chip A17 Pro" class="rounded-lg w-full order-last md:order-first">
                                    <div><h3 class="text-xl font-semibold text-gray-800 mb-2">Chip A17 Pro. Quái vật hiệu năng.</h3><p class="text-gray-600 leading-relaxed">Chip A17 Pro mang đến một cuộc cách mạng đồ họa, cho trải nghiệm game di động đắm chìm hơn bao giờ hết, với môi trường cực kỳ chi tiết và nhân vật siêu thực. Hiệu năng CPU cũng nhanh hơn đến 10%, đảm bảo mọi tác vụ đều mượt mà.</p></div>
                                </div>
                                 <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                                    <div><h3 class="text-xl font-semibold text-gray-800 mb-2">Hệ thống camera Pro đột phá</h3><p class="text-gray-600 leading-relaxed">Từ khả năng đóng khung linh hoạt đầy ấn tượng đến ảnh chân dung thế hệ mới, hãy khám phá những gì bạn có thể làm với hệ thống camera iPhone mạnh mẽ nhất. Camera Chính 48MP cho ảnh độ phân giải siêu cao, cùng camera Telephoto 5x zoom quang học xa nhất từng có trên iPhone.</p></div>
                                    <img src="https://placehold.co/500x300/c0c0c0/333?text=Camera+Pro" alt="Hệ thống camera" class="rounded-lg w-full">
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-4">
                            <button id="read-more-btn" class="font-semibold text-blue-600 hover:text-blue-800">
                                Xem thêm
                            </button>
                        </div>
                    </div>
                    
                    <!-- Content for Specs Tab -->
                    <div id="tab-specs-content" class="tab-content">
                        <div class="space-y-3" id="specs-accordion">
                            <!-- Màn hình -->
                            <div>
                                <button class="accordion-button w-full flex justify-between items-center p-4 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                    <span class="font-semibold text-gray-800">Màn hình</span>
                                    <svg class="accordion-icon w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </button>
                                <div class="accordion-content">
                                    <div class="p-4 border border-t-0 border-gray-200 rounded-b-lg"><dl class="divide-y divide-gray-100"><div class="px-1 py-2 grid grid-cols-3 gap-4"><dt class="text-sm font-medium text-gray-600">Công nghệ màn hình</dt><dd class="text-sm text-gray-800 col-span-2">OLED</dd></div><div class="px-1 py-2 grid grid-cols-3 gap-4"><dt class="text-sm font-medium text-gray-600">Độ phân giải</dt><dd class="text-sm text-gray-800 col-span-2">Super Retina XDR (2796 x 1290 Pixels)</dd></div><div class="px-1 py-2 grid grid-cols-3 gap-4"><dt class="text-sm font-medium text-gray-600">Tần số quét</dt><dd class="text-sm text-gray-800 col-span-2">120 Hz ProMotion</dd></div></dl></div>
                                </div>
                            </div>
                            <!-- Camera -->
                            <div>
                                <button class="accordion-button w-full flex justify-between items-center p-4 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                    <span class="font-semibold text-gray-800">Camera</span>
                                    <svg class="accordion-icon w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </button>
                                <div class="accordion-content">
                                    <div class="p-4 border border-t-0 border-gray-200 rounded-b-lg"><dl class="divide-y divide-gray-100"><div class="px-1 py-2 grid grid-cols-3 gap-4"><dt class="text-sm font-medium text-gray-600">Camera sau</dt><dd class="text-sm text-gray-800 col-span-2">Chính 48 MP & Phụ 12 MP, 12 MP</dd></div><div class="px-1 py-2 grid grid-cols-3 gap-4"><dt class="text-sm font-medium text-gray-600">Camera trước</dt><dd class="text-sm text-gray-800 col-span-2">12 MP</dd></div></dl></div>
                                </div>
                            </div>
                             <!-- Hệ điều hành & CPU -->
                             <div>
                                <button class="accordion-button w-full flex justify-between items-center p-4 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                    <span class="font-semibold text-gray-800">Hệ điều hành & CPU</span>
                                    <svg class="accordion-icon w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </button>
                                <div class="accordion-content">
                                    <div class="p-4 border border-t-0 border-gray-200 rounded-b-lg"><dl class="divide-y divide-gray-100"><div class="px-1 py-2 grid grid-cols-3 gap-4"><dt class="text-sm font-medium text-gray-600">Chip xử lý (CPU)</dt><dd class="text-sm text-gray-800 col-span-2">Apple A17 Pro 6 nhân</dd></div></dl></div>
                                </div>
                            </div>
                             <!-- Kết nối -->
                             <div>
                                <button class="accordion-button w-full flex justify-between items-center p-4 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                    <span class="font-semibold text-gray-800">Kết nối</span>
                                    <svg class="accordion-icon w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </button>
                                <div class="accordion-content">
                                    <div class="p-4 border border-t-0 border-gray-200 rounded-b-lg"><dl class="divide-y divide-gray-100"><div class="px-1 py-2 grid grid-cols-3 gap-4"><dt class="text-sm font-medium text-gray-600">Cổng kết nối/sạc</dt><dd class="text-sm text-gray-800 col-span-2">Type-C</dd></div></dl></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- PHẦN 4: ĐÁNH GIÁ & NHẬN XÉT -->
            <section class="bg-white p-6 md:p-8 rounded-xl shadow-sm">
                 <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Đánh giá & Nhận xét từ khách hàng</h2>
                    <button id="write-review-btn" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">Viết đánh giá</button>
                 </div>
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="flex flex-col items-center justify-center md:border-r md:border-gray-200 md:pr-8">
                        <p class="text-4xl font-bold text-gray-800">4.9 / 5</p>
                        <div class="flex text-yellow-400 my-2">★★★★☆</div>
                        <p class="text-sm text-gray-600">(1,258 đánh giá)</p>
                    </div>
                    <div class="col-span-2">
                        <div class="space-y-1">
                            <div class="flex items-center gap-2 text-sm"><span class="text-yellow-400">5 ★</span><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-yellow-400 h-2.5 rounded-full" style="width: 85%"></div></div><span class="text-gray-600 w-12 text-right">1000</span></div>
                            <div class="flex items-center gap-2 text-sm"><span class="text-yellow-400">4 ★</span><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-yellow-400 h-2.5 rounded-full" style="width: 12%"></div></div><span class="text-gray-600 w-12 text-right">250</span></div>
                            <div class="flex items-center gap-2 text-sm"><span class="text-yellow-400">3 ★</span><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-yellow-400 h-2.5 rounded-full" style="width: 2%"></div></div><span class="text-gray-600 w-12 text-right">8</span></div>
                            <div class="flex items-center gap-2 text-sm"><span class="text-yellow-400">2 ★</span><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-yellow-400 h-2.5 rounded-full" style="width: 0%"></div></div><span class="text-gray-600 w-12 text-right">0</span></div>
                            <div class="flex items-center gap-2 text-sm"><span class="text-yellow-400">1 ★</span><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-yellow-400 h-2.5 rounded-full" style="width: 1%"></div></div><span class="text-gray-600 w-12 text-right">2</span></div>
                        </div>
                    </div>
                 </div>
                 <div class="mt-6 border-t border-gray-200 pt-6">
                    <div class="flex gap-2 mb-4 flex-wrap">
                        <button class="px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full">Tất cả</button>
                        <button class="px-3 py-1 bg-gray-100 text-gray-800 text-sm font-medium rounded-full flex items-center gap-1">5 <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg></button>
                        <button class="px-3 py-1 bg-gray-100 text-gray-800 text-sm font-medium rounded-full flex items-center gap-1">4 <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg></button>
                        <button class="px-3 py-1 bg-gray-100 text-gray-800 text-sm font-medium rounded-full flex items-center gap-1">3 <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg></button>
                        <button class="px-3 py-1 bg-gray-100 text-gray-800 text-sm font-medium rounded-full flex items-center gap-1">2 <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg></button>
                        <button class="px-3 py-1 bg-gray-100 text-gray-800 text-sm font-medium rounded-full flex items-center gap-1">1 <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg></button>
                        <button class="px-3 py-1 bg-gray-100 text-gray-800 text-sm font-medium rounded-full">Có hình ảnh/video</button>
                    </div>
                     <div class="border-b border-gray-200 py-4">
                        <div class="flex items-start gap-3">
                            <img src="https://placehold.co/40x40/7e22ce/ffffff?text=N" alt="Avatar" class="w-10 h-10 rounded-full">
                            <div>
                                <p class="font-semibold text-gray-800">Nguyễn V. An</p>
                                <div class="flex text-yellow-400 text-sm my-1">★★★★★</div>
                                <p class="text-sm text-gray-600">Sản phẩm tuyệt vời, đúng hàng chính hãng. Giao hàng nhanh, đóng gói cẩn thận. Máy mượt, pin trâu, chụp ảnh siêu nét. Rất đáng tiền!</p>
                                <div class="flex gap-2 mt-2"><img src="https://placehold.co/80x80/d0d0d0/333?text=Ảnh+thật" alt="Review Image" class="w-20 h-20 rounded-md object-cover"><img src="https://placehold.co/80x80/c0c0c0/333?text=Ảnh+thật" alt="Review Image" class="w-20 h-20 rounded-md object-cover"></div>
                                <div class="text-xs text-gray-500 mt-2 flex items-center gap-4"><span>2 ngày trước</span><button class="flex items-center gap-1 text-blue-600 hover:underline"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"></path></svg>Hữu ích</button></div>
                            </div>
                        </div>
                     </div>
                 </div>
            </section>
            
            <!-- PHẦN 5: HỎI & ĐÁP -->
            <section class="bg-white p-6 md:p-8 rounded-xl shadow-sm">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Hỏi & Đáp</h2>
                <div class="mb-6">
                    <textarea id="qna-textarea" placeholder="Để lại câu hỏi của bạn..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" rows="3"></textarea>
                    <button id="qna-submit-btn" class="mt-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">Gửi câu hỏi</button>
                </div>
                <div id="qna-list" class="space-y-4">
                    <!-- Q&A items will be dynamically inserted here -->
                </div>
                <!-- Pagination -->
                <nav id="qna-pagination" class="flex items-center justify-center mt-6"></nav>
            </section>

            <!-- PHẦN 6: SẢN PHẨM TƯƠNG TỰ -->
            <section>
                 <h2 class="text-2xl font-bold text-gray-900 mb-6">Sản phẩm tương tự</h2>
                 <div class="carousel flex gap-4 overflow-x-auto pb-4">
                    <div class="product-card flex-shrink-0 w-52 bg-white rounded-lg shadow-sm overflow-hidden transform hover:-translate-y-1 transition-transform"><img src="https://placehold.co/200x200/e0e0e0/333?text=iPhone+15+Plus" class="w-full h-40 object-cover"><div class="p-3"><h4 class="font-semibold text-sm text-gray-800 truncate">iPhone 15 Plus 128GB</h4><p class="font-bold text-red-600 mt-1">24.990.000₫</p><div class="flex items-center gap-1 text-xs text-yellow-500 mt-1">4.8 ★</div></div></div>
                    <div class="product-card flex-shrink-0 w-52 bg-white rounded-lg shadow-sm overflow-hidden transform hover:-translate-y-1 transition-transform"><img src="https://placehold.co/200x200/e0e0e0/333?text=Galaxy+S24+Ultra" class="w-full h-40 object-cover"><div class="p-3"><h4 class="font-semibold text-sm text-gray-800 truncate">Samsung Galaxy S24 Ultra</h4><p class="font-bold text-red-600 mt-1">28.490.000₫</p><div class="flex items-center gap-1 text-xs text-yellow-500 mt-1">4.9 ★</div></div></div>
                    <div class="product-card flex-shrink-0 w-52 bg-white rounded-lg shadow-sm overflow-hidden transform hover:-translate-y-1 transition-transform"><img src="https://placehold.co/200x200/e0e0e0/333?text=iPhone+15+Pro" class="w-full h-40 object-cover"><div class="p-3"><h4 class="font-semibold text-sm text-gray-800 truncate">iPhone 15 Pro 128GB</h4><p class="font-bold text-red-600 mt-1">27.990.000₫</p><div class="flex items-center gap-1 text-xs text-yellow-500 mt-1">4.9 ★</div></div></div>
                 </div>
            </section>
        </div>
    </div>

    <!-- MODALS SECTION -->
    
    <!-- Compare Modal -->
    <div id="compare-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col transform transition-transform duration-300 scale-95">
            <div class="flex justify-between items-center p-4 border-b border-gray-200 flex-shrink-0"><h3 class="text-xl font-bold text-gray-900">So sánh sản phẩm</h3><button id="close-modal-btn" class="text-gray-500 hover:text-gray-700 text-3xl leading-none">&times;</button></div>
            <div class="p-4 sm:p-6 overflow-y-auto"><table class="w-full text-sm text-left border-collapse"><thead><tr><th class="w-1/4 py-3"></th><th class="w-3/8 p-2 align-bottom"><div class="flex flex-col items-center text-center"><img src="https://placehold.co/100x100/f0f0f0/333?text=iPhone+15" class="w-24 h-24 object-cover rounded-lg mb-2"><p class="font-semibold text-gray-800">iPhone 15 Pro Max</p><p class="text-red-600 font-bold">32.790.000₫</p></div></th><th class="w-3/8 p-2 align-bottom"><div class="flex flex-col items-center justify-center text-center h-full border-2 border-dashed border-gray-300 rounded-lg p-4 hover:border-blue-500 hover:bg-gray-50 cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-400 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg><p class="font-semibold text-gray-600">Thêm sản phẩm</p></div></th></tr></thead><tbody class="divide-y divide-gray-200"><tr class="bg-gray-50"><td class="py-3 px-2 font-semibold text-gray-800" colspan="3">Màn hình</td></tr><tr><td class="py-3 px-4 text-gray-600">Công nghệ màn hình</td><td class="py-3 px-2 text-center text-gray-800">OLED</td><td class="py-3 px-2 text-center text-gray-400">-</td></tr><tr><td class="py-3 px-4 text-gray-600">Độ phân giải</td><td class="py-3 px-2 text-center text-gray-800">Super Retina XDR</td><td class="py-3 px-2 text-center text-gray-400">-</td></tr><tr class="bg-gray-50"><td class="py-3 px-2 font-semibold text-gray-800" colspan="3">Camera</td></tr><tr><td class="py-3 px-4 text-gray-600">Camera sau</td><td class="py-3 px-2 text-center text-gray-800">Chính 48 MP & Phụ 12 MP, 12 MP</td><td class="py-3 px-2 text-center text-gray-400">-</td></tr><tr><td class="py-3 px-4 text-gray-600">Camera trước</td><td class="py-3 px-2 text-center text-gray-800">12 MP</td><td class="py-3 px-2 text-center text-gray-400">-</td></tr><tr class="bg-gray-50"><td class="py-3 px-2 font-semibold text-gray-800" colspan="3">Hiệu năng & Pin</td></tr><tr><td class="py-3 px-4 text-gray-600">Chip xử lý</td><td class="py-3 px-2 text-center text-gray-800">Apple A17 Pro</td><td class="py-3 px-2 text-center text-gray-400">-</td></tr><tr><td class="py-3 px-4 text-gray-600">Pin</td><td class="py-3 px-2 text-center text-gray-800">~ 29 giờ xem video</td><td class="py-3 px-2 text-center text-gray-400">-</td></tr></tbody></table></div>
        </div>
    </div>

    <!-- Image Lightbox Modal -->
    <div id="image-lightbox-modal" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden flex-col items-center justify-center p-4 transition-opacity duration-300">
        <div class="absolute top-4 left-1/2 -translate-x-1/2 z-10 flex items-center gap-4 bg-black/50 p-2 rounded-full">
            <button id="lightbox-zoom-in" class="text-white hover:text-gray-300"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path></svg></button>
            <button id="lightbox-zoom-out" class="text-white hover:text-gray-300"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"></path></svg></button>
            <button id="lightbox-fullscreen" class="text-white hover:text-gray-300"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 0h-4m4 0l-5-5"></path></svg></button>
        </div>
        <button id="close-lightbox-btn" class="absolute top-4 right-6 text-white text-5xl leading-none z-10 hover:text-gray-300">&times;</button>
        <div class="relative w-full h-full flex flex-col items-center justify-center">
            <div class="relative flex-1 flex items-center justify-center w-full max-h-[80vh] mt-12 mb-24 overflow-hidden">
                <img id="lightbox-main-image" src="" class="max-h-full max-w-full object-contain rounded-lg">
                <button id="lightbox-prev-btn" class="absolute left-4 sm:left-8 text-white p-2 rounded-full bg-black/40 hover:bg-black/70 transition-colors"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                <button id="lightbox-next-btn" class="absolute right-4 sm:right-8 text-white p-2 rounded-full bg-black/40 hover:bg-black/70 transition-colors"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>
            </div>
            <div class="absolute bottom-0 left-0 right-0 p-4 bg-black bg-opacity-20"><div class="max-w-4xl mx-auto"><div class="text-white text-left mb-4"><p id="lightbox-description" class="font-semibold text-lg"></p><p id="lightbox-counter" class="text-sm text-gray-300"></p></div><div id="lightbox-thumbnails" class="flex justify-center gap-2"></div></div></div>
        </div>
    </div>

    <!-- Write Review Modal -->
    <div id="review-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg transform transition-transform duration-300 scale-95">
            <div class="flex justify-between items-center p-4 border-b border-gray-200"><h3 class="text-xl font-bold text-gray-900">Viết đánh giá</h3><button id="close-review-modal-btn" class="text-gray-500 hover:text-gray-700 text-3xl leading-none">&times;</button></div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="font-semibold text-gray-700">Đánh giá của bạn</label>
                    <div id="review-stars-container" class="flex items-center gap-1 text-4xl mt-1">
                        <!-- Stars will be generated by JS -->
                    </div>
                </div>
                <div>
                    <label for="review-text" class="font-semibold text-gray-700">Bình luận</label>
                    <textarea id="review-text" placeholder="Hãy chia sẻ cảm nhận của bạn về sản phẩm..." class="mt-1 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" rows="4"></textarea>
                </div>
                <div>
                    <label class="font-semibold text-gray-700">Thêm hình ảnh/video</label>
                    <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                        <div class="space-y-1 text-center">
                            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
                            <div class="flex text-sm text-gray-600"><label for="file-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500"><span>Tải lên một file</span><input id="file-upload" name="file-upload" type="file" class="sr-only" multiple></label><p class="pl-1">hoặc kéo và thả</p></div>
                            <p class="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
                        </div>
                    </div>
                </div>
                <div class="text-right">
                    <button id="submit-review-btn" class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 transition-colors">Gửi đánh giá</button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Info Modal (Off-canvas) -->
    <div id="user-info-modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden opacity-0 transition-opacity duration-300"></div>
    <div id="user-info-modal" class="fixed top-0 left-0 h-full w-full max-w-md bg-white z-50 transform -translate-x-full transition-transform duration-300">
        <div class="flex flex-col h-full">
            <div class="flex justify-between items-center p-4 border-b flex-shrink-0">
                <h3 class="text-xl font-bold text-gray-900">Thông tin người gửi</h3>
                <button id="close-user-info-modal-btn" class="text-gray-500 hover:text-gray-700 text-3xl leading-none">&times;</button>
            </div>
            <div class="p-6 space-y-4 flex-grow">
                <div class="flex gap-4">
                    <label class="flex items-center"><input type="radio" name="gender" class="h-4 w-4 text-red-600 border-gray-300 focus:ring-red-500" checked> <span class="ml-2">Anh</span></label>
                    <label class="flex items-center"><input type="radio" name="gender" class="h-4 w-4 text-red-600 border-gray-300 focus:ring-red-500"> <span class="ml-2">Chị</span></label>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" placeholder="Nhập họ và tên" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <input type="tel" placeholder="Nhập số điện thoại" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <input type="email" placeholder="Nhập Email (nhận thông báo phản hồi)" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="p-6 bg-white border-t flex-shrink-0">
                <label class="flex items-center text-sm text-gray-600">
                    <input id="terms-checkbox" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <span class="ml-2">Tôi đồng ý với điều khoản dịch vụ, chính sách thu thập và xử lý dữ liệu cá nhân của Shop</span>
                </label>
                <button id="qna-complete-btn" class="mt-4 w-full bg-gray-300 text-gray-500 font-semibold py-3 rounded-lg cursor-not-allowed" disabled>Hoàn tất</button>
            </div>
        </div>
    </div>
    
    <!-- Sticky Add to Cart Bar -->
    <div id="sticky-bar" class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-sm p-3 shadow-[0_-2px_10px_rgba(0,0,0,0.1)] transform translate-y-full transition-transform duration-300 z-40">
        <div class="container mx-auto flex items-center justify-between gap-4">
            <div class="flex items-center gap-3">
                <img src="https://placehold.co/50x50/f0f0f0/333?text=i15" alt="iPhone 15 Pro Max" class="w-12 h-12 rounded-md object-cover">
                <div>
                    <p class="font-semibold text-sm text-gray-800">iPhone 15 Pro Max 256GB</p>
                    <p class="text-xs text-gray-500">Phân loại: 256GB, Titan Xanh</p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                 <div>
                    <p class="font-bold text-red-600 text-right">32.790.000₫</p>
                    <p class="text-xs text-gray-500 line-through text-right">34.990.000₫</p>
                 </div>
                 <button class="hidden sm:flex items-center justify-center p-3 border-2 border-red-600 text-red-600 font-bold rounded-lg hover:bg-red-50 transition-colors">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                 </button>
                 <button class="flex-1 w-full sm:w-auto px-6 py-3 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition-colors">
                    Mua ngay
                </button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- GALLERY DATA ---
            const galleryData = [
                {
                    thumb: 'https://placehold.co/120x120/f0f0f0/333?text=Góc+trước',
                    main: 'https://placehold.co/600x600/f0f0f0/333?text=Góc+trước',
                    lightbox: 'https://placehold.co/1200x1200/f0f0f0/333?text=Góc+trước',
                    description: 'Vẻ ngoài cứng cáp, độ bền ấn tượng',
                    type: 'image'
                },
                {
                    thumb: 'https://placehold.co/120x120/e0e0e0/333?text=Góc+nghiêng',
                    main: 'https://placehold.co/600x600/e0e0e0/333?text=Góc+nghiêng',
                    lightbox: 'https://placehold.co/1200x1200/e0e0e0/333?text=Góc+nghiêng',
                    description: 'Khung viền Titan chuẩn hàng không vũ trụ',
                    type: 'image'
                },
                {
                    thumb: 'https://placehold.co/120x120/d0d0d0/333?text=Cụm+Camera',
                    main: 'https://placehold.co/600x600/d0d0d0/333?text=Cụm+Camera',
                    lightbox: 'https://placehold.co/1200x1200/d0d0d0/333?text=Cụm+Camera',
                    description: 'Hệ thống camera Pro đột phá',
                    type: 'image'
                },
                {
                    thumb: 'https://placehold.co/120x120/c0c0c0/333?text=Video+Review',
                    main: 'https://placehold.co/600x600/c0c0c0/333?text=Video+Review',
                    lightbox: 'https://placehold.co/1200x1200/c0c0c0/333?text=Video+Review',
                    description: 'Video đánh giá chi tiết sản phẩm',
                    type: 'video'
                },
                {
                    thumb: 'https://placehold.co/120x120/b0b0b0/333?text=Ảnh+360°',
                    main: 'https://placehold.co/600x600/b0b0b0/333?text=Ảnh+360°',
                    lightbox: 'https://placehold.co/1200x1200/b0b0b0/333?text=Ảnh+360°',
                    description: 'Trải nghiệm xoay 360 độ',
                    type: '360'
                }
            ];
            let currentImageIndex = 0;

            // --- ELEMENTS ---
            const mainImage = document.getElementById('mainImage');
            const mainThumbnailsContainer = document.getElementById('main-thumbnails');
            const mainImageContainer = document.getElementById('main-image-container');
            const galleryPrevBtn = document.getElementById('gallery-prev-btn');
            const galleryNextBtn = document.getElementById('gallery-next-btn');
            
            // Lightbox elements
            const lightboxModal = document.getElementById('image-lightbox-modal');
            const closeLightboxBtn = document.getElementById('close-lightbox-btn');
            const lightboxMainImage = document.getElementById('lightbox-main-image');
            const lightboxPrevBtn = document.getElementById('lightbox-prev-btn');
            const lightboxNextBtn = document.getElementById('lightbox-next-btn');
            const lightboxDescription = document.getElementById('lightbox-description');
            const lightboxCounter = document.getElementById('lightbox-counter');
            const lightboxThumbnailsContainer = document.getElementById('lightbox-thumbnails');
            const lightboxZoomInBtn = document.getElementById('lightbox-zoom-in');
            const lightboxZoomOutBtn = document.getElementById('lightbox-zoom-out');
            const lightboxFullscreenBtn = document.getElementById('lightbox-fullscreen');

            // --- INITIALIZE MAIN GALLERY ---
            function initializeGallery() {
                mainThumbnailsContainer.innerHTML = '';
                galleryData.forEach((item, index) => {
                    const thumbDiv = document.createElement('div');
                    thumbDiv.className = `thumbnail-item relative cursor-pointer rounded-md border-2 ${index === 0 ? 'border-blue-500 thumbnail-selected' : 'border-transparent'}`;
                    thumbDiv.onclick = () => changeImage(index);

                    const img = document.createElement('img');
                    img.src = item.thumb;
                    img.alt = `Thumbnail ${index + 1}`;
                    img.className = 'w-full h-full object-cover rounded';
                    thumbDiv.appendChild(img);

                    if (item.type !== 'image') {
                        const overlay = document.createElement('div');
                        overlay.className = 'absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center rounded';
                        let iconSvg = '';
                        if (item.type === 'video') {
                            iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>`;
                        } else if (item.type === '360') {
                            iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 text-white"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.664 0l3.181-3.183m-11.664 0l4.992-4.993m-14.976 0h4.992m-4.993 0l3.181-3.183a8.25 8.25 0 0111.664 0l3.181 3.183" /></svg>`;
                        }
                        overlay.innerHTML = iconSvg;
                        thumbDiv.appendChild(overlay);
                    }
                    mainThumbnailsContainer.appendChild(thumbDiv);
                });
                changeImage(0);
            }

            // --- CHANGE IMAGE ON MAIN PAGE ---
            window.changeImage = function(index) {
                currentImageIndex = index;
                mainImage.src = galleryData[index].main;

                const thumbnails = mainThumbnailsContainer.querySelectorAll('.thumbnail-item');
                thumbnails.forEach((thumb, i) => {
                    thumb.classList.toggle('thumbnail-selected', i === index);
                    thumb.classList.toggle('border-blue-500', i === index);
                    thumb.classList.toggle('border-transparent', i !== index);
                });
            }

            // --- LIGHTBOX LOGIC ---
            function updateLightboxView() {
                const item = galleryData[currentImageIndex];
                lightboxMainImage.src = item.lightbox;
                lightboxDescription.textContent = item.description;
                lightboxCounter.textContent = `${currentImageIndex + 1} / ${galleryData.length}`;
                lightboxMainImage.classList.remove('zoomed'); // Reset zoom on image change

                const lightboxThumbs = lightboxThumbnailsContainer.querySelectorAll('img');
                lightboxThumbs.forEach((thumb, i) => {
                    thumb.classList.toggle('ring-2', i === currentImageIndex);
                    thumb.classList.toggle('ring-white', i === currentImageIndex);
                    thumb.classList.toggle('opacity-60', i !== currentImageIndex);
                });
            }
            
            function openLightbox(index) {
                currentImageIndex = index;
                populateLightboxThumbnails();
                updateLightboxView();
                lightboxModal.classList.remove('hidden');
                lightboxModal.classList.add('flex');
            }

            function closeLightbox() {
                lightboxModal.classList.add('hidden');
                lightboxModal.classList.remove('flex');
                 if (document.fullscreenElement) {
                    document.exitFullscreen();
                }
            }

            function showNextImage() {
                currentImageIndex = (currentImageIndex + 1) % galleryData.length;
                updateLightboxView();
            }

            function showPrevImage() {
                currentImageIndex = (currentImageIndex - 1 + galleryData.length) % galleryData.length;
                updateLightboxView();
            }
            
            function toggleZoom() {
                lightboxMainImage.classList.toggle('zoomed');
            }

            function populateLightboxThumbnails() {
                if (lightboxThumbnailsContainer.children.length > 0) return; // Populate only once
                galleryData.forEach((item, index) => {
                    const img = document.createElement('img');
                    img.src = item.thumb;
                    img.className = 'w-16 h-16 object-cover rounded-md cursor-pointer hover:opacity-100 transition-opacity';
                    img.onclick = () => {
                        currentImageIndex = index;
                        updateLightboxView();
                    };
                    lightboxThumbnailsContainer.appendChild(img);
                });
            }

            // --- EVENT LISTENERS ---
            mainImageContainer.addEventListener('click', () => openLightbox(currentImageIndex));
            closeLightboxBtn.addEventListener('click', closeLightbox);
            lightboxNextBtn.addEventListener('click', showNextImage);
            lightboxPrevBtn.addEventListener('click', showPrevImage);
            lightboxMainImage.addEventListener('dblclick', toggleZoom);
            lightboxZoomInBtn.addEventListener('click', () => lightboxMainImage.classList.add('zoomed'));
            lightboxZoomOutBtn.addEventListener('click', () => lightboxMainImage.classList.remove('zoomed'));
            lightboxFullscreenBtn.addEventListener('click', () => {
                if (!document.fullscreenElement) {
                    lightboxModal.requestFullscreen().catch(err => {
                        alert(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                    });
                } else {
                    document.exitFullscreen();
                }
            });

            document.addEventListener('keydown', (e) => {
                if (lightboxModal.classList.contains('hidden')) return;
                if (e.key === 'ArrowRight') showNextImage();
                if (e.key === 'ArrowLeft') showPrevImage();
                if (e.key === 'Escape') closeLightbox();
            });

            galleryPrevBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent lightbox from opening
                const newIndex = (currentImageIndex - 1 + galleryData.length) % galleryData.length;
                changeImage(newIndex);
            });

            galleryNextBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent lightbox from opening
                const newIndex = (currentImageIndex + 1) % galleryData.length;
                changeImage(newIndex);
            });
            
            // --- VARIANT SELECTION ---
            window.selectColor = function(element, colorName) { const colorButtons = document.querySelectorAll('.variants div button[style]'); colorButtons.forEach(btn => btn.classList.remove('ring-blue-500')); element.classList.add('ring-blue-500'); document.getElementById('colorName').textContent = colorName; }
            window.selectVariant = function(element) { const variantButtons = document.querySelectorAll('.variants div button:not([style])'); variantButtons.forEach(btn => { btn.classList.remove('variant-selected'); btn.classList.add('border-gray-300', 'text-gray-700', 'hover:border-blue-500'); }); element.classList.add('variant-selected'); element.classList.remove('border-gray-300', 'text-gray-700', 'hover:border-blue-500'); }
            
            // --- QUANTITY SELECTOR ---
            const minusBtn = document.getElementById('minusBtn'); const plusBtn = document.getElementById('plusBtn'); const quantityInput = document.getElementById('quantityInput');
            minusBtn.addEventListener('click', () => { let currentValue = parseInt(quantityInput.value); if (currentValue > 1) { quantityInput.value = currentValue - 1; } });
            plusBtn.addEventListener('click', () => { let currentValue = parseInt(quantityInput.value); quantityInput.value = currentValue + 1; });
            
            // --- SPECS ACCORDION ---
            const accordionButtons = document.querySelectorAll('.accordion-button');
            accordionButtons.forEach(button => { button.addEventListener('click', () => { const content = button.nextElementSibling; const icon = button.querySelector('.accordion-icon'); if (content.style.maxHeight) { content.style.maxHeight = null; icon.classList.remove('rotate-180'); } else { content.style.maxHeight = content.scrollHeight + 'px'; icon.classList.add('rotate-180'); } }); });
            
            // --- TABS & READ MORE ---
            const tabDescBtn = document.getElementById('tab-desc-btn');
            const tabSpecsBtn = document.getElementById('tab-specs-btn');
            const tabDescContent = document.getElementById('tab-desc-content');
            const tabSpecsContent = document.getElementById('tab-specs-content');
            const descriptionWrapper = document.getElementById('description-wrapper');
            const readMoreBtn = document.getElementById('read-more-btn');

            tabSpecsContent.style.display = 'block';
            tabDescContent.style.display = 'none';
            tabSpecsBtn.classList.add('tab-active');
            tabDescBtn.classList.remove('tab-active');

            tabDescBtn.addEventListener('click', () => {
                tabDescContent.style.display = 'block';
                tabSpecsContent.style.display = 'none';
                tabDescBtn.classList.add('tab-active');
                tabSpecsBtn.classList.remove('tab-active');
            });

            tabSpecsBtn.addEventListener('click', () => {
                tabSpecsContent.style.display = 'block';
                tabDescContent.style.display = 'none';
                tabSpecsBtn.classList.add('tab-active');
                tabDescBtn.classList.remove('tab-active');
            });

            readMoreBtn.addEventListener('click', () => {
                if (descriptionWrapper.classList.contains('collapsed')) {
                    descriptionWrapper.classList.remove('collapsed');
                    readMoreBtn.textContent = 'Thu gọn';
                } else {
                    descriptionWrapper.classList.add('collapsed');
                    readMoreBtn.textContent = 'Xem thêm';
                }
            });

            // --- MODAL HELPER ---
            function showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (!modal) return;
                const modalContent = modal.querySelector('div');
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    modalContent.classList.remove('scale-95');
                }, 10);
            }

            function hideModal(modalId) {
                const modal = document.getElementById(modalId);
                if (!modal) return;
                const modalContent = modal.querySelector('div');
                modal.classList.add('opacity-0');
                modalContent.classList.add('scale-95');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                }, 300);
            }

            // --- COMPARE MODAL ---
            const compareBtn = document.getElementById('compare-btn');
            const compareModal = document.getElementById('compare-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            compareBtn.addEventListener('click', () => showModal('compare-modal'));
            closeModalBtn.addEventListener('click', () => hideModal('compare-modal'));
            compareModal.addEventListener('click', (event) => { if (event.target === compareModal) hideModal('compare-modal'); });
            
            // --- FAVORITE BUTTON ---
            const favoriteBtn = document.getElementById('favorite-btn');
            const favoriteIconContainer = document.getElementById('favorite-icon-container');
            const outlineIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.5l1.318-1.182a4.5 4.5 0 116.364 6.364L12 21l-7.682-7.318a4.5 4.5 0 010-6.364z" /></svg>`;
            const solidIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" /></svg>`;
            favoriteBtn.addEventListener('click', () => {
                const isFavorited = favoriteBtn.classList.toggle('favorited');
                favoriteIconContainer.innerHTML = isFavorited ? solidIcon : outlineIcon;
            });

            // --- SHARE POPOVER ---
            const shareBtn = document.getElementById('share-btn');
            const sharePopover = document.getElementById('share-popover');
            const copyLinkBtn = document.getElementById('copy-link-btn');
            shareBtn.addEventListener('click', (event) => {
                event.stopPropagation();
                sharePopover.classList.toggle('hidden');
            });
            copyLinkBtn.addEventListener('click', () => {
                const url = window.location.href;
                const textarea = document.createElement('textarea');
                textarea.value = url;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                copyLinkBtn.textContent = 'Đã sao chép!';
                setTimeout(() => { copyLinkBtn.textContent = 'Sao chép link'; }, 2000);
            });
            document.addEventListener('click', (event) => {
                if (!shareBtn.contains(event.target) && !sharePopover.contains(event.target)) {
                    sharePopover.classList.add('hidden');
                }
            });

            // --- BUNDLE DEAL ---
            const bundleCheckboxes = document.querySelectorAll('.bundle-checkbox');
            const bundleTotalPriceEl = document.getElementById('bundle-total-price');
            const basePrice = 32790000;
            function calculateBundleTotal() {
                let total = basePrice;
                bundleCheckboxes.forEach(checkbox => { if (checkbox.checked) { total += parseInt(checkbox.dataset.price); } });
                bundleTotalPriceEl.textContent = total.toLocaleString('vi-VN') + '₫';
            }
            bundleCheckboxes.forEach(checkbox => checkbox.addEventListener('change', calculateBundleTotal));
            
            // --- REVIEW MODAL ---
            const writeReviewBtn = document.getElementById('write-review-btn');
            const reviewModal = document.getElementById('review-modal');
            const closeReviewModalBtn = document.getElementById('close-review-modal-btn');
            const reviewStarsContainer = document.getElementById('review-stars-container');
            let selectedRating = 0;

            for (let i = 1; i <= 5; i++) {
                const star = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                star.setAttribute('class', 'review-star w-8 h-8');
                star.setAttribute('fill', 'currentColor');
                star.setAttribute('viewBox', '0 0 20 20');
                star.innerHTML = `<path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>`;
                star.dataset.rating = i;
                reviewStarsContainer.appendChild(star);
            }
            const reviewStars = reviewStarsContainer.querySelectorAll('.review-star');
            reviewStars.forEach(star => {
                star.addEventListener('mouseover', () => reviewStars.forEach(s => s.classList.toggle('hover', s.dataset.rating <= star.dataset.rating)));
                star.addEventListener('mouseout', () => reviewStars.forEach(s => s.classList.remove('hover')));
                star.addEventListener('click', () => { selectedRating = star.dataset.rating; reviewStars.forEach(s => s.classList.toggle('selected', s.dataset.rating <= selectedRating)); });
            });
            writeReviewBtn.addEventListener('click', () => showModal('review-modal'));
            closeReviewModalBtn.addEventListener('click', () => hideModal('review-modal'));
            reviewModal.addEventListener('click', (event) => { if (event.target === reviewModal) hideModal('review-modal'); });

            // --- Q&A SECTION ---
            const qnaSubmitBtn = document.getElementById('qna-submit-btn');
            const userInfoModalOverlay = document.getElementById('user-info-modal-overlay');
            const userInfoModal = document.getElementById('user-info-modal');
            const closeUserInfoModalBtn = document.getElementById('close-user-info-modal-btn');
            const termsCheckbox = document.getElementById('terms-checkbox');
            const qnaCompleteBtn = document.getElementById('qna-complete-btn');

            qnaSubmitBtn.addEventListener('click', () => {
                const qnaText = document.getElementById('qna-textarea').value;
                if (qnaText.trim() === '') {
                    // In a real app, you'd show a proper message.
                    alert('Vui lòng nhập câu hỏi của bạn.');
                    return;
                }
                userInfoModalOverlay.classList.remove('hidden');
                userInfoModal.classList.add('open');
                userInfoModalOverlay.classList.add('open');
            });

            function hideUserInfoModal() {
                userInfoModal.classList.remove('open');
                userInfoModalOverlay.classList.remove('open');
                // Use setTimeout to match transition duration
                setTimeout(() => {
                    userInfoModalOverlay.classList.add('hidden');
                }, 300);
            }

            closeUserInfoModalBtn.addEventListener('click', hideUserInfoModal);
            userInfoModalOverlay.addEventListener('click', hideUserInfoModal);
            
            termsCheckbox.addEventListener('change', () => {
                if (termsCheckbox.checked) {
                    qnaCompleteBtn.disabled = false;
                    qnaCompleteBtn.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                    qnaCompleteBtn.classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-700');
                } else {
                    qnaCompleteBtn.disabled = true;
                    qnaCompleteBtn.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                    qnaCompleteBtn.classList.remove('bg-blue-600', 'text-white', 'hover:bg-blue-700');
                }
            });

            // Dummy Q&A Data
            const qnaData = [
                { q: 'Sản phẩm này có hỗ trợ eSIM không?', a: 'Chào bạn, iPhone 15 Pro Max bản VN/A chính hãng hỗ trợ 1 SIM vật lý và nhiều eSIM nhé.' },
                { q: 'Chế độ bảo hành như thế nào?', a: 'Sản phẩm được bảo hành chính hãng 12 tháng tại các trung tâm bảo hành uỷ quyền của Apple trên toàn quốc ạ.' },
                { q: 'Shop có hỗ trợ giao hàng hoả tốc không?', a: 'Dạ có ạ, shop có hỗ trợ giao hàng hoả tốc trong nội thành TP.HCM và Hà Nội, bạn vui lòng liên hệ hotline để được hỗ trợ nhé.' },
                { q: 'Phụ kiện đi kèm có những gì?', a: 'Dạ trong hộp sản phẩm có máy, cáp sạc USB-C và sách hướng dẫn sử dụng ạ.' },
                { q: 'Máy có chống nước không?', a: 'Chào bạn, iPhone 15 Pro Max có chuẩn kháng nước và bụi IP68 ạ.' },
                { q: 'Làm sao để áp dụng trả góp 0%?', a: 'Dạ bạn chỉ cần có thẻ tín dụng của các ngân hàng được hỗ trợ là có thể áp dụng trả góp 0% khi thanh toán ạ.' }
            ];

            const qnaListEl = document.getElementById('qna-list');
            const qnaPaginationEl = document.getElementById('qna-pagination');
            let qnaCurrentPage = 1;
            const qnaItemsPerPage = 3;

            function renderQna() {
                qnaListEl.innerHTML = '';
                const start = (qnaCurrentPage - 1) * qnaItemsPerPage;
                const end = start + qnaItemsPerPage;
                const paginatedItems = qnaData.slice(start, end);

                for (const item of paginatedItems) {
                    const qnaItem = document.createElement('div');
                    qnaItem.className = 'faq-item border-t border-gray-200 pt-4';
                    qnaItem.innerHTML = `
                        <p class="font-semibold text-gray-800">Q: ${item.q}</p>
                        <p class="text-sm text-gray-600 mt-1 pl-4 border-l-2 border-blue-200">A: ${item.a}</p>
                    `;
                    qnaListEl.appendChild(qnaItem);
                }
            }

            function setupQnaPagination() {
                qnaPaginationEl.innerHTML = '';
                const pageCount = Math.ceil(qnaData.length / qnaItemsPerPage);
                for (let i = 1; i <= pageCount; i++) {
                    const btn = document.createElement('button');
                    btn.innerText = i;
                    btn.className = `px-3 py-1 mx-1 rounded-md text-sm font-medium ${i === qnaCurrentPage ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`;
                    btn.addEventListener('click', () => {
                        qnaCurrentPage = i;
                        renderQna();
                        setupQnaPagination();
                    });
                    qnaPaginationEl.appendChild(btn);
                }
            }
            
            // --- STICKY BAR ---
            const stickyBar = document.getElementById('sticky-bar');
            const mainCtaButtons = document.getElementById('main-cta-buttons');
            
            const scrollObserver = new IntersectionObserver((entries) => {
                if (!entries[0].isIntersecting) {
                    stickyBar.classList.remove('translate-y-full');
                } else {
                    stickyBar.classList.add('translate-y-full');
                }
            }, { threshold: 0 });
            
            scrollObserver.observe(mainCtaButtons);


            // --- INITIALIZE ---
            initializeGallery();
            calculateBundleTotal();
            renderQna();
            setupQnaPagination();
        });
    </script>

</body>
</html>
